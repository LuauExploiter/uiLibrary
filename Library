-- FINAL WORKING UI - EVERYTHING SHOWS UP & WORKS
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local UILib = {}
UILib.__index = UILib

-- Black theme with blue accents
local Colors = {
    Background = Color3.fromRGB(20, 20, 25),
    Foreground = Color3.fromRGB(30, 30, 40),
    Primary = Color3.fromRGB(0, 120, 255),
    Text = Color3.fromRGB(240, 240, 245),
    SubText = Color3.fromRGB(160, 160, 170),
    Border = Color3.fromRGB(50, 50, 60),
    Close = Color3.fromRGB(255, 60, 60),
    Minimize = Color3.fromRGB(255, 180, 40)
}

-- Create RECTANGULAR window
function UILib:Create(title)
    local self = setmetatable({}, UILib)
    
    -- ScreenGui
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "UILib_" .. math.random(1000, 9999)
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    -- Main Window - RECTANGULAR (400x500)
    self.Window = Instance.new("Frame")
    self.Window.Name = "Window"
    self.Window.Size = UDim2.new(0, 400, 0, 500)
    self.Window.Position = UDim2.new(0.5, -200, 0.5, -250)
    self.Window.BackgroundColor3 = Colors.Background
    self.Window.BorderSizePixel = 0
    self.Window.ClipsDescendants = true
    self.Window.Parent = self.ScreenGui
    
    -- Rounded corners on window
    local windowCorner = Instance.new("UICorner")
    windowCorner.CornerRadius = UDim.new(0, 10)
    windowCorner.Parent = self.Window
    
    -- Stroke around window
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Colors.Primary
    stroke.Parent = self.Window
    
    -- Top bar for dragging
    self.TopBar = Instance.new("Frame")
    self.TopBar.Name = "TopBar"
    self.TopBar.Size = UDim2.new(1, 0, 0, 40)
    self.TopBar.BackgroundColor3 = Colors.Foreground
    self.TopBar.BorderSizePixel = 0
    self.TopBar.Parent = self.Window
    
    -- Rounded top corners only
    local topCorner = Instance.new("UICorner")
    topCorner.CornerRadius = UDim.new(0, 10, 0, 0)
    topCorner.Parent = self.TopBar
    
    -- Title
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(0, 200, 1, 0)
    titleLabel.Position = UDim2.new(0, 15, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "UI Library"
    titleLabel.TextColor3 = Colors.Text
    titleLabel.TextSize = 16
    titleLabel.Font = Enum.Font.GothamSemibold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = self.TopBar
    
    -- Close button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "Close"
    closeBtn.Size = UDim2.new(0, 25, 0, 25)
    closeBtn.Position = UDim2.new(1, -30, 0.5, -12.5)
    closeBtn.BackgroundColor3 = Colors.Close
    closeBtn.TextColor3 = Colors.Text
    closeBtn.TextSize = 18
    closeBtn.Text = "×"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = self.TopBar
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 6)
    closeCorner.Parent = closeBtn
    
    -- Minimize button
    local minBtn = Instance.new("TextButton")
    minBtn.Name = "Minimize"
    minBtn.Size = UDim2.new(0, 25, 0, 25)
    minBtn.Position = UDim2.new(1, -60, 0.5, -12.5)
    minBtn.BackgroundColor3 = Colors.Minimize
    minBtn.TextColor3 = Colors.Text
    minBtn.TextSize = 18
    minBtn.Text = "-"
    minBtn.Font = Enum.Font.GothamBold
    minBtn.Parent = self.TopBar
    
    local minCorner = Instance.new("UICorner")
    minCorner.CornerRadius = UDim.new(0, 6)
    minCorner.Parent = minBtn
    
    -- Tabs container
    self.TabsContainer = Instance.new("Frame")
    self.TabsContainer.Name = "Tabs"
    self.TabsContainer.Size = UDim2.new(1, -20, 0, 30)
    self.TabsContainer.Position = UDim2.new(0, 10, 0, 45)
    self.TabsContainer.BackgroundTransparency = 1
    self.TabsContainer.Parent = self.Window
    
    local tabsLayout = Instance.new("UIListLayout")
    tabsLayout.FillDirection = Enum.FillDirection.Horizontal
    tabsLayout.Padding = UDim.new(0, 5)
    tabsLayout.Parent = self.TabsContainer
    
    -- Content area (WHERE ELEMENTS GO)
    self.Content = Instance.new("ScrollingFrame")
    self.Content.Name = "Content"
    self.Content.Size = UDim2.new(1, -20, 1, -85) -- 400 - 20 = 380 width
    self.Content.Position = UDim2.new(0, 10, 0, 80)
    self.Content.BackgroundTransparency = 1
    self.Content.BorderSizePixel = 0
    self.Content.ScrollBarThickness = 4
    self.Content.ScrollBarImageColor3 = Colors.SubText
    self.Content.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.Content.ScrollingDirection = Enum.ScrollingDirection.Y
    self.Content.Parent = self.Window
    
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, 10)
    contentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    contentLayout.Parent = self.Content
    
    -- DRAGGING SYSTEM THAT WORKS
    local dragging = false
    local dragStart, windowStart
    
    local function updateDrag(input)
        local delta = input.Position - dragStart
        self.Window.Position = UDim2.new(
            windowStart.X.Scale,
            windowStart.X.Offset + delta.X,
            windowStart.Y.Scale,
            windowStart.Y.Offset + delta.Y
        )
    end
    
    self.TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            windowStart = self.Window.Position
            
            -- Highlight
            local tween = TweenService:Create(self.TopBar, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = Colors.Foreground:lerp(Colors.Primary, 0.2)}
            )
            tween:Play()
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateDrag(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            local tween = TweenService:Create(self.TopBar, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = Colors.Foreground}
            )
            tween:Play()
        end
    end)
    
    -- Button hover effects
    local function setupButton(btn)
        btn.MouseEnter:Connect(function()
            local tween = TweenService:Create(btn, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = btn.BackgroundColor3:lerp(Color3.new(1,1,1), 0.2)}
            )
            tween:Play()
        end)
        
        btn.MouseLeave:Connect(function()
            local original = Colors.Close
            if btn.Name == "Minimize" then original = Colors.Minimize end
            
            local tween = TweenService:Create(btn, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = original}
            )
            tween:Play()
        end)
    end
    
    setupButton(closeBtn)
    setupButton(minBtn)
    
    -- Window functionality
    local minimized = false
    local originalSize = self.Window.Size
    
    minBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        if minimized then
            local tween = TweenService:Create(self.Window, 
                TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset, 0, 40)}
            )
            tween:Play()
        else
            local tween = TweenService:Create(self.Window, 
                TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Size = originalSize}
            )
            tween:Play()
        end
    end)
    
    closeBtn.MouseButton1Click:Connect(function()
        local tween = TweenService:Create(self.Window, 
            TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 0, 0, 0)}
        )
        tween:Play()
        task.wait(0.2)
        self.ScreenGui:Destroy()
    end)
    
    -- Store tabs
    self.Tabs = {}
    self.CurrentTab = nil
    
    return self
end

-- Create Tab
function UILib:Tab(name)
    -- Tab button
    local tabBtn = Instance.new("TextButton")
    tabBtn.Name = name .. "Tab"
    tabBtn.Size = UDim2.new(0, 70, 1, 0)
    tabBtn.BackgroundColor3 = Colors.Foreground
    tabBtn.Text = name
    tabBtn.TextColor3 = Colors.SubText
    tabBtn.TextSize = 14
    tabBtn.Font = Enum.Font.Gotham
    tabBtn.Parent = self.TabsContainer
    
    -- Rounded corners
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 6)
    tabCorner.Parent = tabBtn
    
    -- Tab content frame
    local tabContent = Instance.new("Frame")
    tabContent.Name = name .. "Content"
    tabContent.Size = UDim2.new(1, 0, 0, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.Visible = false
    tabContent.Parent = self.Content
    
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, 10)
    contentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    contentLayout.Parent = tabContent
    
    local tab = {
        Button = tabBtn,
        Content = tabContent,
        Name = name
    }
    
    -- Set as active if first tab
    if not self.CurrentTab then
        self.CurrentTab = tab
        tabBtn.BackgroundColor3 = Colors.Primary
        tabBtn.TextColor3 = Colors.Text
        tabContent.Visible = true
    end
    
    -- Tab switching
    tabBtn.MouseButton1Click:Connect(function()
        if self.CurrentTab == tab then return end
        
        -- Deactivate old tab
        if self.CurrentTab then
            self.CurrentTab.Content.Visible = false
            local tween = TweenService:Create(self.CurrentTab.Button, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {
                    BackgroundColor3 = Colors.Foreground,
                    TextColor3 = Colors.SubText
                }
            )
            tween:Play()
        end
        
        -- Activate new tab
        self.CurrentTab = tab
        tabContent.Visible = true
        
        local tween = TweenService:Create(tabBtn, 
            TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {
                BackgroundColor3 = Colors.Primary,
                TextColor3 = Colors.Text
            }
        )
        tween:Play()
    end)
    
    -- Tab hover effect
    tabBtn.MouseEnter:Connect(function()
        if self.CurrentTab ~= tab then
            local tween = TweenService:Create(tabBtn, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = Colors.Foreground:lerp(Colors.Primary, 0.3)}
            )
            tween:Play()
        end
    end)
    
    tabBtn.MouseLeave:Connect(function()
        if self.CurrentTab ~= tab then
            local tween = TweenService:Create(tabBtn, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = Colors.Foreground}
            )
            tween:Play()
        end
    end)
    
    table.insert(self.Tabs, tab)
    
    -- Element creation methods
    local methods = {}
    
    -- BUTTON
    function methods:Button(text, callback)
        local btn = Instance.new("TextButton")
        btn.Name = "Button"
        btn.Size = UDim2.new(1, -20, 0, 40)
        btn.BackgroundColor3 = Colors.Foreground
        btn.Text = text
        btn.TextColor3 = Colors.Text
        btn.TextSize = 14
        btn.Font = Enum.Font.GothamSemibold
        btn.Parent = self.CurrentTab.Content
        
        -- Rounded corners
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 8)
        btnCorner.Parent = btn
        
        -- Hover effect
        btn.MouseEnter:Connect(function()
            local tween = TweenService:Create(btn, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {
                    BackgroundColor3 = Colors.Primary,
                    Size = UDim2.new(1, -15, 0, 40)
                }
            )
            tween:Play()
        end)
        
        btn.MouseLeave:Connect(function()
            local tween = TweenService:Create(btn, 
                TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {
                    BackgroundColor3 = Colors.Foreground,
                    Size = UDim2.new(1, -20, 0, 40)
                }
            )
            tween:Play()
        end)
        
        -- Click
        btn.MouseButton1Click:Connect(function()
            if callback then
                callback()
            end
        end)
        
        return btn
    end
    
    -- TOGGLE
    function methods:Toggle(text, default, callback)
        local frame = Instance.new("Frame")
        frame.Name = "Toggle"
        frame.Size = UDim2.new(1, -20, 0, 40)
        frame.BackgroundColor3 = Colors.Foreground
        frame.Parent = self.CurrentTab.Content
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = frame
        
        -- Label
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.7, 0, 1, 0)
        label.Position = UDim2.new(0, 10, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = frame
        
        -- Toggle switch
        local toggle = Instance.new("Frame")
        toggle.Size = UDim2.new(0, 50, 0, 25)
        toggle.Position = UDim2.new(1, -60, 0.5, -12.5)
        toggle.BackgroundColor3 = Colors.Border
        toggle.Parent = frame
        
        local toggleCorner = Instance.new("UICorner")
        toggleCorner.CornerRadius = UDim.new(0, 12)
        toggleCorner.Parent = toggle
        
        -- Toggle dot
        local dot = Instance.new("Frame")
        dot.Size = UDim2.new(0, 21, 0, 21)
        dot.Position = UDim2.new(0, 2, 0.5, -10.5)
        dot.BackgroundColor3 = Colors.Text
        dot.Parent = toggle
        
        local dotCorner = Instance.new("UICorner")
        dotCorner.CornerRadius = UDim.new(0, 10)
        dotCorner.Parent = dot
        
        -- State
        local state = default or false
        if state then
            dot.Position = UDim2.new(1, -23, 0.5, -10.5)
            toggle.BackgroundColor3 = Colors.Primary
        end
        
        -- Click area
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 1, 0)
        btn.BackgroundTransparency = 1
        btn.Text = ""
        btn.Parent = frame
        
        btn.MouseButton1Click:Connect(function()
            state = not state
            if state then
                local tween1 = TweenService:Create(dot, 
                    TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {Position = UDim2.new(1, -23, 0.5, -10.5)}
                )
                tween1:Play()
                
                local tween2 = TweenService:Create(toggle, 
                    TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {BackgroundColor3 = Colors.Primary}
                )
                tween2:Play()
            else
                local tween1 = TweenService:Create(dot, 
                    TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {Position = UDim2.new(0, 2, 0.5, -10.5)}
                )
                tween1:Play()
                
                local tween2 = TweenService:Create(toggle, 
                    TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {BackgroundColor3 = Colors.Border}
                )
                tween2:Play()
            end
            
            if callback then
                callback(state)
            end
        end)
        
        return frame
    end
    
    -- SLIDER
    function methods:Slider(text, min, max, default, callback)
        local frame = Instance.new("Frame")
        frame.Name = "Slider"
        frame.Size = UDim2.new(1, -20, 0, 55)
        frame.BackgroundColor3 = Colors.Foreground
        frame.Parent = self.CurrentTab.Content
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = frame
        
        -- Label
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.7, 0, 0, 20)
        label.Position = UDim2.new(0, 10, 0, 5)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = frame
        
        -- Value
        local value = Instance.new("TextLabel")
        value.Size = UDim2.new(0, 50, 0, 20)
        value.Position = UDim2.new(1, -60, 0, 5)
        value.BackgroundTransparency = 1
        value.Text = tostring(default or min)
        value.TextColor3 = Colors.Primary
        value.TextSize = 14
        value.Font = Enum.Font.GothamSemibold
        value.TextXAlignment = Enum.TextXAlignment.Right
        value.Parent = frame
        
        -- Track
        local track = Instance.new("Frame")
        track.Size = UDim2.new(1, -20, 0, 6)
        track.Position = UDim2.new(0, 10, 0, 35)
        track.BackgroundColor3 = Colors.Border
        track.Parent = frame
        
        local trackCorner = Instance.new("UICorner")
        trackCorner.CornerRadius = UDim.new(0, 3)
        trackCorner.Parent = track
        
        -- Fill
        local fill = Instance.new("Frame")
        fill.Size = UDim2.new(0, 0, 1, 0)
        fill.BackgroundColor3 = Colors.Primary
        fill.Parent = track
        
        local fillCorner = Instance.new("UICorner")
        fillCorner.CornerRadius = UDim.new(0, 3)
        fillCorner.Parent = fill
        
        -- Knob
        local knob = Instance.new("Frame")
        knob.Size = UDim2.new(0, 16, 0, 16)
        knob.Position = UDim2.new(0, -8, 0.5, -8)
        knob.BackgroundColor3 = Colors.Primary
        knob.ZIndex = 2
        knob.Parent = fill
        
        local knobCorner = Instance.new("UICorner")
        knobCorner.CornerRadius = UDim.new(0, 8)
        knobCorner.Parent = knob
        
        -- Slider logic
        local current = default or min
        local dragging = false
        
        local function update(val)
            val = math.clamp(val, min, max)
            current = val
            local percent = (val - min) / (max - min)
            fill.Size = UDim2.new(percent, 0, 1, 0)
            value.Text = tostring(math.floor(val))
            
            if callback then
                callback(val)
            end
        end
        
        update(current)
        
        -- Mouse interactions
        track.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                local mouse = UserInputService:GetMouseLocation()
                local pos = track.AbsolutePosition
                local size = track.AbsoluteSize
                local x = (mouse.X - pos.X) / size.X
                x = math.clamp(x, 0, 1)
                local val = min + (x * (max - min))
                update(val)
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local mouse = UserInputService:GetMouseLocation()
                local pos = track.AbsolutePosition
                local size = track.AbsoluteSize
                local x = (mouse.X - pos.X) / size.X
                x = math.clamp(x, 0, 1)
                local val = min + (x * (max - min))
                update(val)
            end
        end)
        
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        
        return frame
    end
    
    -- TEXTBOX
    function methods:Textbox(placeholder, callback)
        local frame = Instance.new("Frame")
        frame.Name = "Textbox"
        frame.Size = UDim2.new(1, -20, 0, 45)
        frame.BackgroundColor3 = Colors.Foreground
        frame.Parent = self.CurrentTab.Content
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = frame
        
        -- Input box
        local box = Instance.new("TextBox")
        box.Size = UDim2.new(1, -20, 0, 30)
        box.Position = UDim2.new(0, 10, 0.5, -15)
        box.BackgroundColor3 = Colors.Background
        box.TextColor3 = Colors.Text
        box.PlaceholderColor3 = Colors.SubText
        box.PlaceholderText = placeholder or "Type here..."
        box.Text = ""
        box.TextSize = 14
        box.Font = Enum.Font.Gotham
        box.ClearTextOnFocus = false
        box.Parent = frame
        
        local boxCorner = Instance.new("UICorner")
        boxCorner.CornerRadius = UDim.new(0, 6)
        boxCorner.Parent = box
        
        -- Enter key to submit
        box.FocusLost:Connect(function(enterPressed)
            if enterPressed and callback then
                callback(box.Text)
            end
        end)
        
        return frame
    end
    
    -- DROPDOWN
    function methods:Dropdown(text, options, callback)
        local frame = Instance.new("Frame")
        frame.Name = "Dropdown"
        frame.Size = UDim2.new(1, -20, 0, 40)
        frame.BackgroundColor3 = Colors.Foreground
        frame.ClipsDescendants = true
        frame.Parent = self.CurrentTab.Content
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = frame
        
        -- Button
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 40)
        btn.BackgroundTransparency = 1
        btn.Text = ""
        btn.Parent = frame
        
        -- Label
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.8, 0, 1, 0)
        label.Position = UDim2.new(0, 10, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text .. " ▼"
        label.TextColor3 = Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = btn
        
        -- Options frame
        local optionsFrame = Instance.new("Frame")
        optionsFrame.Size = UDim2.new(1, 0, 0, 0)
        optionsFrame.Position = UDim2.new(0, 0, 0, 40)
        optionsFrame.BackgroundColor3 = Colors.Background
        optionsFrame.Visible = false
        optionsFrame.Parent = frame
        
        local optionsCorner = Instance.new("UICorner")
        optionsCorner.CornerRadius = UDim.new(0, 6)
        optionsCorner.Parent = optionsFrame
        
        local open = false
        
        local function toggle()
            open = not open
            if open then
                frame.Size = UDim2.new(1, -20, 0, 40 + (#options * 35))
                optionsFrame.Visible = true
                local tween = TweenService:Create(optionsFrame, 
                    TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {Size = UDim2.new(1, 0, 0, #options * 35)}
                )
                tween:Play()
                label.Text = text .. " ▲"
            else
                local tween = TweenService:Create(optionsFrame, 
                    TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {Size = UDim2.new(1, 0, 0, 0)}
                )
                tween:Play()
                label.Text = text .. " ▼"
                task.wait(0.2)
                if not open then
                    optionsFrame.Visible = false
                    frame.Size = UDim2.new(1, -20, 0, 40)
                end
            end
        end
        
        -- Create options
        for i, option in ipairs(options) do
            local optBtn = Instance.new("TextButton")
            optBtn.Size = UDim2.new(1, 0, 0, 35)
            optBtn.BackgroundColor3 = Colors.Background
            optBtn.Text = option
            optBtn.TextColor3 = Colors.Text
            optBtn.TextSize = 14
            optBtn.Font = Enum.Font.Gotham
            optBtn.Parent = optionsFrame
            
            optBtn.MouseButton1Click:Connect(function()
                toggle()
                if callback then
                    callback(option)
                end
            end)
        end
        
        btn.MouseButton1Click:Connect(toggle)
        
        return frame
    end
    
    -- MULTI-SELECT
    function methods:MultiSelect(text, options, callback)
        local frame = Instance.new("Frame")
        frame.Name = "MultiSelect"
        frame.Size = UDim2.new(1, -20, 0, 40)
        frame.BackgroundColor3 = Colors.Foreground
        frame.ClipsDescendants = true
        frame.Parent = self.CurrentTab.Content
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = frame
        
        -- Button
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 40)
        btn.BackgroundTransparency = 1
        btn.Text = ""
        btn.Parent = frame
        
        -- Label
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.8, 0, 1, 0)
        label.Position = UDim2.new(0, 10, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text .. " ▼"
        label.TextColor3 = Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = btn
        
        -- Options frame
        local optionsFrame = Instance.new("Frame")
        optionsFrame.Size = UDim2.new(1, 0, 0, 0)
        optionsFrame.Position = UDim2.new(0, 0, 0, 40)
        optionsFrame.BackgroundColor3 = Colors.Background
        optionsFrame.Visible = false
        optionsFrame.Parent = frame
        
        local optionsCorner = Instance.new("UICorner")
        optionsCorner.CornerRadius = UDim.new(0, 6)
        optionsCorner.Parent = optionsFrame
        
        local open = false
        local selected = {}
        
        local function toggle()
            open = not open
            if open then
                frame.Size = UDim2.new(1, -20, 0, 40 + (#options * 35))
                optionsFrame.Visible = true
                local tween = TweenService:Create(optionsFrame, 
                    TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {Size = UDim2.new(1, 0, 0, #options * 35)}
                )
                tween:Play()
                label.Text = text .. " ▲"
            else
                local tween = TweenService:Create(optionsFrame, 
                    TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {Size = UDim2.new(1, 0, 0, 0)}
                )
                tween:Play()
                label.Text = text .. " ▼"
                task.wait(0.2)
                if not open then
                    optionsFrame.Visible = false
                    frame.Size = UDim2.new(1, -20, 0, 40)
                end
            end
        end
        
        -- Create options
        for i, option in ipairs(options) do
            local optFrame = Instance.new("Frame")
            optFrame.Size = UDim2.new(1, 0, 0, 35)
            optFrame.BackgroundColor3 = Colors.Background
            optFrame.Parent = optionsFrame
            
            -- Checkbox
            local checkbox = Instance.new("Frame")
            checkbox.Size = UDim2.new(0, 20, 0, 20)
            checkbox.Position = UDim2.new(0, 10, 0.5, -10)
            checkbox.BackgroundColor3 = Colors.Border
            checkbox.Parent = optFrame
            
            local checkCorner = Instance.new("UICorner")
            checkCorner.CornerRadius = UDim.new(0, 4)
            checkCorner.Parent = checkbox
            
            -- Checkmark
            local check = Instance.new("Frame")
            check.Size = UDim2.new(0, 14, 0, 14)
            check.Position = UDim2.new(0, 3, 0, 3)
            check.BackgroundColor3 = Colors.Primary
            check.Visible = false
            check.Parent = checkbox
            
            local checkMarkCorner = Instance.new("UICorner")
            checkMarkCorner.CornerRadius = UDim.new(0, 3)
            checkMarkCorner.Parent = check
            
            -- Option label
            local optLabel = Instance.new("TextLabel")
            optLabel.Size = UDim2.new(1, -40, 1, 0)
            optLabel.Position = UDim2.new(0, 35, 0, 0)
            optLabel.BackgroundTransparency = 1
            optLabel.Text = option
            optLabel.TextColor3 = Colors.Text
            optLabel.TextSize = 14
            optLabel.Font = Enum.Font.Gotham
            optLabel.TextXAlignment = Enum.TextXAlignment.Left
            optLabel.Parent = optFrame
            
            -- Click area
            local optBtn = Instance.new("TextButton")
            optBtn.Size = UDim2.new(1, 0, 1, 0)
            optBtn.BackgroundTransparency = 1
            optBtn.Text = ""
            optBtn.Parent = optFrame
            
            optBtn.MouseButton1Click:Connect(function()
                selected[option] = not selected[option]
                check.Visible = selected[option]
                
                if callback then
                    local list = {}
                    for opt, sel in pairs(selected) do
                        if sel then
                            table.insert(list, opt)
                        end
                    end
                    callback(list)
                end
            end)
        end
        
        btn.MouseButton1Click:Connect(toggle)
        
        return frame
    end
    
    return setmetatable(methods, {__index = methods})
end

return UILib
