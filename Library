local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")

local UI = {}
UI.__index = UI

local function Create(class, props)
    local obj = Instance.new(class)
    for i,v in pairs(props) do
        if i ~= "Parent" then obj[i] = v end
    end
    if props.Parent then obj.Parent = props.Parent end
    return obj
end

function UI:Window(title, size, pos)
    local ScreenGui = Create("ScreenGui", {
        Name = "UI_Library_ScreenGui",
        ResetOnSpawn = false,
        Parent = PlayerGui
    })

    local Main = Create("Frame", {
        Parent = ScreenGui,
        Size = size or UDim2.new(0,480,0,360),
        Position = pos or UDim2.new(0.1,0,0.1,0),
        BackgroundColor3 = Color3.fromRGB(18,18,22),
        BorderSizePixel = 0
    })

    Create("UICorner",{Parent=Main,CornerRadius=UDim.new(0,14)})
    local Stroke = Create("UIStroke",{Parent=Main,Thickness=1,Transparency=0.4})

    local Top = Create("Frame",{
        Parent=Main,
        Size=UDim2.new(1,0,0,38),
        BackgroundTransparency=1
    })

    local Title = Create("TextLabel",{
        Parent=Top,
        Position=UDim2.new(0,12,0,0),
        Size=UDim2.new(1,-90,1,0),
        BackgroundTransparency=1,
        Font=Enum.Font.GothamBold,
        Text=title or "UI Library",
        TextSize=14,
        TextColor3=Color3.fromRGB(230,230,235),
        TextXAlignment=Left
    })

    local Close = Create("TextButton",{
        Parent=Top,
        Size=UDim2.new(0,36,0,26),
        Position=UDim2.new(1,-40,0,6),
        BackgroundColor3=Color3.fromRGB(255,80,80),
        Text="X",
        Font=Enum.Font.GothamBold,
        TextSize=14,
        TextColor3=Color3.new(1,1,1)
    })
    Create("UICorner",{Parent=Close,CornerRadius=UDim.new(0,8)})

    local Min = Create("TextButton",{
        Parent=Top,
        Size=UDim2.new(0,36,0,26),
        Position=UDim2.new(1,-82,0,6),
        BackgroundColor3=Color3.fromRGB(90,90,95),
        Text="â€“",
        Font=Enum.Font.GothamBold,
        TextSize=14,
        TextColor3=Color3.new(1,1,1)
    })
    Create("UICorner",{Parent=Min,CornerRadius=UDim.new(0,8)})

    local Tabs = Create("Frame",{
        Parent=Main,
        Position=UDim2.new(0,10,0,48),
        Size=UDim2.new(0,120,1,-58),
        BackgroundTransparency=1
    })

    local TabLayout = Create("UIListLayout",{
        Parent=Tabs,
        Padding=UDim.new(0,8)
    })

    local Content = Create("Frame",{
        Parent=Main,
        Position=UDim2.new(0,140,0,48),
        Size=UDim2.new(1,-150,1,-58),
        BackgroundTransparency=1
    })

    
    local dragging, dragInput, startPos, startFrame
    Top.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            startPos = i.Position
            startFrame = Main.Position
            i.Changed:Connect(function()
                if i.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = i.Position - startPos
            TweenService:Create(Main,TweenInfo.new(0.12),{
                Position = UDim2.new(startFrame.X.Scale,startFrame.X.Offset+delta.X,startFrame.Y.Scale,startFrame.Y.Offset+delta.Y)
            }):Play()
        end
    end)

    Close.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    local minimized=false
    local oldSize = Main.Size
    Min.MouseButton1Click:Connect(function()
        minimized=not minimized
        TweenService:Create(Main,TweenInfo.new(0.25),{
            Size = minimized and UDim2.new(oldSize.X.Scale,oldSize.X.Offset,0,38) or oldSize
        }):Play()
    end)

    local Window = {}
    local TabsList = {}

    function Window:Tab(name)
        local TabBtn = Create("TextButton",{
            Parent=Tabs,
            Size=UDim2.new(1,0,0,34),
            BackgroundColor3=Color3.fromRGB(30,30,36),
            Text=name,
            Font=Enum.Font.Gotham,
            TextSize=13,
            TextColor3=Color3.fromRGB(220,220,220)
        })
        Create("UICorner",{Parent=TabBtn,CornerRadius=UDim.new(0,8)})

        local Page = Create("Frame",{
            Parent=Content,
            Size=UDim2.new(1,0,1,0),
            Visible=false,
            BackgroundTransparency=1
        })

        local Layout = Create("UIListLayout",{Parent=Page,Padding=UDim.new(0,8)})
        Create("UIPadding",{
            Parent=Page,
            PaddingTop=UDim.new(0,6),
            PaddingLeft=UDim.new(0,6),
            PaddingRight=UDim.new(0,6)
        })

        TabBtn.MouseButton1Click:Connect(function()
            for _,v in pairs(TabsList) do v.Page.Visible=false end
            Page.Visible=true
        end)

        table.insert(TabsList,{Button=TabBtn,Page=Page})

        if #TabsList == 1 then Page.Visible = true end

        local Tab = {}

        function Tab:Label(text)
            Create("TextLabel",{
                Parent=Page,
                Size=UDim2.new(1,0,0,26),
                BackgroundTransparency=1,
                Text=text,
                Font=Enum.Font.GothamBold,
                TextSize=13,
                TextColor3=Color3.fromRGB(200,200,200)
            })
        end

        function Tab:Button(text,cb)
            local B = Create("TextButton",{
                Parent=Page,
                Size=UDim2.new(1,0,0,34),
                BackgroundColor3=Color3.fromRGB(50,130,255),
                Text=text,
                Font=Enum.Font.GothamBold,
                TextSize=13,
                TextColor3=Color3.new(1,1,1)
            })
            Create("UICorner",{Parent=B,CornerRadius=UDim.new(0,8)})
            B.MouseButton1Click:Connect(cb)
        end

        function Tab:Toggle(text,default,cb)
            local state = default
            local B = Create("TextButton",{
                Parent=Page,
                Size=UDim2.new(1,0,0,34),
                BackgroundColor3=default and Color3.fromRGB(0,200,120) or Color3.fromRGB(60,60,70),
                Text=text.." : "..(default and "ON" or "OFF"),
                Font=Enum.Font.Gotham,
                TextSize=13,
                TextColor3=Color3.new(1,1,1)
            })
            Create("UICorner",{Parent=B,CornerRadius=UDim.new(0,8)})
            B.MouseButton1Click:Connect(function()
                state=not state
                B.BackgroundColor3 = state and Color3.fromRGB(0,200,120) or Color3.fromRGB(60,60,70)
                B.Text=text.." : "..(state and "ON" or "OFF")
                cb(state)
            end)
        end

        function Tab:TextBox(ph,cb)
            local Box = Create("TextBox",{
                Parent=Page,
                Size=UDim2.new(1,0,0,34),
                BackgroundColor3=Color3.fromRGB(35,35,40),
                Text="",
                PlaceholderText=ph,
                Font=Enum.Font.Gotham,
                TextSize=13,
                TextColor3=Color3.new(1,1,1)
            })
            Create("UICorner",{Parent=Box,CornerRadius=UDim.new(0,8)})
            Box.FocusLost:Connect(function() cb(Box.Text) end)
        end

        return Tab
    end

    return Window
end

return setmetatable({},UI)
