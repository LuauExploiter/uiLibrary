

local UI = {}

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local guiParent = player:WaitForChild("PlayerGui")

UI.Theme = {
    Background = Color3.fromRGB(20,20,20),
    Main = Color3.fromRGB(0,255,200),
    Secondary = Color3.fromRGB(35,35,35),
    Text = Color3.fromRGB(255,255,255),
    Rainbow = false
}

function UI:AddCorner(obj,radius)
    local c = Instance.new("UICorner",obj)
    c.CornerRadius = UDim.new(0,radius or 8)
    return c
end

function UI:Tween(obj,props,dur)
    TweenService:Create(obj,TweenInfo.new(dur or 0.25,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),props):Play()
end

function UI:Create(class,props)
    local obj = Instance.new(class)
    for k,v in pairs(props or {}) do obj[k]=v end
    return obj
end

function UI:Window(title,size,pos)
    local screenGui = self:Create("ScreenGui",{Parent=guiParent,ResetOnSpawn=false})
    local frame = self:Create("Frame",{Parent=screenGui,Size=size or UDim2.new(0,450,0,350),Position=pos or UDim2.new(0,20,0,20),BackgroundColor3=self.Theme.Background,ZIndex=2})
    self:AddCorner(frame,16)
    frame.Active=true
    frame.Draggable=true

    
    local shadow = self:Create("Frame",{Parent=frame,Size=UDim2.new(1,10,1,10),Position=UDim2.new(0,-5,0,-5),BackgroundColor3=Color3.fromRGB(0,0,0),BackgroundTransparency=0.6,ZIndex=1})
    self:AddCorner(shadow,16)

    
    local titleBar = self:Create("Frame",{Parent=frame,Size=UDim2.new(1,0,0,30),BackgroundColor3=self.Theme.Secondary,ZIndex=3})
    self:AddCorner(titleBar,16)
    local titleLabel = self:Create("TextLabel",{Parent=titleBar,Text=title or "Window",Size=UDim2.new(0.8,0,1,0),BackgroundTransparency=1,TextColor3=self.Theme.Text,Font=Enum.Font.GothamBold,TextSize=18,TextXAlignment=Enum.TextXAlignment.Left})
    titleLabel.Position = UDim2.new(0,10,0,0)

    
    local closeBtn = self:Create("TextButton",{Parent=titleBar,Size=UDim2.new(0,30,0,30),Position=UDim2.new(0.9,0,0,0),Text="X",Font=Enum.Font.GothamBold,TextSize=18,TextColor3=self.Theme.Text,BackgroundColor3=self.Theme.Main})
    self:AddCorner(closeBtn,8)
    closeBtn.MouseEnter:Connect(function() UI:Tween(closeBtn,{BackgroundColor3=self.Theme.Secondary},0.15) end)
    closeBtn.MouseLeave:Connect(function() UI:Tween(closeBtn,{BackgroundColor3=self.Theme.Main},0.15) end)
    closeBtn.MouseButton1Click:Connect(function() frame.Visible=false end)

    
    local minimizeBtn = self:Create("TextButton",{Parent=titleBar,Size=UDim2.new(0,30,0,30),Position=UDim2.new(0.82,0,0,0),Text="_",Font=Enum.Font.GothamBold,TextSize=18,TextColor3=self.Theme.Text,BackgroundColor3=self.Theme.Main})
    self:AddCorner(minimizeBtn,8)
    local isMinimized=false
    minimizeBtn.MouseEnter:Connect(function() UI:Tween(minimizeBtn,{BackgroundColor3=self.Theme.Secondary},0.15) end)
    minimizeBtn.MouseLeave:Connect(function() UI:Tween(minimizeBtn,{BackgroundColor3=self.Theme.Main},0.15) end)
    minimizeBtn.MouseButton1Click:Connect(function()
        isMinimized = not isMinimized
        frame.Size = isMinimized and UDim2.new(0,450,0,30) or size or UDim2.new(0,450,0,350)
    end)

    
    local tabHolder = self:Create("Frame",{Parent=frame,Size=UDim2.new(1,0,0,30),Position=UDim2.new(0,0,0,30),BackgroundTransparency=1})
    local contentHolder = self:Create("Frame",{Parent=frame,Size=UDim2.new(1,-20,1,-70),Position=UDim2.new(0,10,0,70),BackgroundTransparency=1})

    local tabs={}
    local tabButtons={}

    function frame:Tab(name)
        local tabBtn = self:Create("TextButton",{Parent=tabHolder,Size=UDim2.new(0,100,1,0),Position=UDim2.new(#tabButtons*0.22,0,0,0),Text=name,Font=Enum.Font.GothamBold,TextSize=14,TextColor3=UI.Theme.Text,BackgroundColor3=self.Theme.Secondary})
        UI:AddCorner(tabBtn,6)
        table.insert(tabButtons,tabBtn)

        local tabContent = UI:Create("Frame",{Parent=contentHolder,Size=UDim2.new(1,0,1,0),BackgroundTransparency=1,Visible=false})
        table.insert(tabs,tabContent)

        tabBtn.MouseEnter:Connect(function()
            UI:Tween(tabBtn,{BackgroundColor3=self.Theme.Main},0.15)
        end)
        tabBtn.MouseLeave:Connect(function()
            UI:Tween(tabBtn,{BackgroundColor3=self.Theme.Secondary},0.15)
        end)

        tabBtn.MouseButton1Click:Connect(function()
            for _,v in pairs(tabs) do v.Visible=false end
            tabContent.Visible=true
        end)

        local tabAPI={}

        
        function tabAPI:Button(text,callback)
            local btn = UI:Create("TextButton",{Parent=tabContent,Size=UDim2.new(1,-10,0,40),Position=UDim2.new(0,5,0,#tabContent:GetChildren()*45),Text=text,Font=Enum.Font.GothamBold,TextSize=16,TextColor3=UI.Theme.Text,BackgroundColor3=UI.Theme.Main})
            UI:AddCorner(btn,8)
            btn.MouseEnter:Connect(function() UI:Tween(btn,{BackgroundColor3=UI.Theme.Secondary},0.15) end)
            btn.MouseLeave:Connect(function() UI:Tween(btn,{BackgroundColor3=UI.Theme.Main},0.15) end)
            if callback then btn.MouseButton1Click:Connect(callback) end
            return btn
        end

        
        function tabAPI:Label(text)
            local lbl = UI:Create("TextLabel",{Parent=tabContent,Size=UDim2.new(1,-10,0,30),Position=UDim2.new(0,5,0,#tabContent:GetChildren()*35),Text=text,TextColor3=UI.Theme.Text,BackgroundTransparency=1,Font=Enum.Font.Gotham,TextSize=16,TextXAlignment=Enum.TextXAlignment.Left})
            return lbl
        end

        
        function tabAPI:Toggle(text,default,callback)
            local frameToggle = UI:Create("Frame",{Parent=tabContent,Size=UDim2.new(1,-10,0,35),Position=UDim2.new(0,5,0,#tabContent:GetChildren()*40),BackgroundTransparency=1})
            local lbl = UI:Create("TextLabel",{Parent=frameToggle,Size=UDim2.new(0.7,0,1,0),Position=UDim2.new(0,0,0,0),Text=text,TextColor3=UI.Theme.Text,BackgroundTransparency=1,Font=Enum.Font.Gotham,TextSize=16,TextXAlignment=Enum.TextXAlignment.Left})
            local btn = UI:Create("TextButton",{Parent=frameToggle,Size=UDim2.new(0.25,0,0.6,0),Position=UDim2.new(0.74,0,0.2,0),BackgroundColor3=default and UI.Theme.Main or UI.Theme.Secondary,Text=default and "ON" or "OFF",TextColor3=Color3.new(1,1,1),Font=Enum.Font.GothamBold,TextSize=14})
            UI:AddCorner(btn,6)
            local state=default
            btn.MouseButton1Click:Connect(function()
                state=not state
                btn.Text=state and "ON" or "OFF"
                btn.BackgroundColor3=state and UI.Theme.Main or UI.Theme.Secondary
                if callback then pcall(callback,state) end
            end)
            return frameToggle
        end

        
        function tabAPI:Slider(text,min,max,default,callback)
            local frameSlider = UI:Create("Frame",{Parent=tabContent,Size=UDim2.new(1,-10,0,50),Position=UDim2.new(0,5,0,#tabContent:GetChildren()*55),BackgroundTransparency=1})
            local lbl = UI:Create("TextLabel",{Parent=frameSlider,Size=UDim2.new(1,0,0,20),Position=UDim2.new(0,0,0,0),BackgroundTransparency=1,Text=text.." : "..default,TextColor3=UI.Theme.Text,Font=Enum.Font.Gotham,TextSize=16,TextXAlignment=Enum.TextXAlignment.Left})
            local bar = UI:Create("Frame",{Parent=frameSlider,Size=UDim2.new(1,0,0,10),Position=UDim2.new(0,0,0,30),BackgroundColor3=UI.Theme.Secondary})
            UI:AddCorner(bar,6)
            local fill = UI:Create("Frame",{Parent=bar,Size=UDim2.new((default-min)/(max-min),0,1,0),BackgroundColor3=UI.Theme.Main})
            UI:AddCorner(fill,6)

            local dragging=false
            bar.InputBegan:Connect(function(input) if input.UserInputType==Enum.UserInputType.MouseButton1 then dragging=true end end)
            UserInputService.InputEnded:Connect(function(input) if input.UserInputType==Enum.UserInputType.MouseButton1 then dragging=false end end)
            UserInputService.InputChanged:Connect(function(input)
                if dragging and input.UserInputType==Enum.UserInputType.MouseMovement then
                    local x = math.clamp(input.Position.X - bar.AbsolutePosition.X,0,bar.AbsoluteSize.X)
                    local val = min + ((max-min)*(x/bar.AbsoluteSize.X))
                    fill.Size = UDim2.new(x/bar.AbsoluteSize.X,0,1,0)
                    lbl.Text = text.." : "..math.floor(val)
                    if callback then pcall(callback,val) end
                end
            end)
            return frameSlider
        end

        
        function tabAPI:Dropdown(text,options,callback)
            local frameDrop = UI:Create("Frame",{Parent=tabContent,Size=UDim2.new(1,-10,0,35),Position=UDim2.new(0,5,0,#tabContent:GetChildren()*45),BackgroundTransparency=1})
            local lbl = UI:Create("TextLabel",{Parent=frameDrop,Size=UDim2.new(0.7,0,1,0),Position=UDim2.new(0,0,0,0),Text=text,TextColor3=UI.Theme.Text,BackgroundTransparency=1,Font=Enum.Font.Gotham,TextSize=16,TextXAlignment=Enum.TextXAlignment.Left})
            local btn = UI:Create("TextButton",{Parent=frameDrop,Size=UDim2.new(0.25,0,0.6,0),Position=UDim2.new(0.74,0,0.2,0),Text="Select",TextColor3=UI.Theme.Text,Font=Enum.Font.GothamBold,TextSize=14,BackgroundColor3=UI.Theme.Main})
            UI:AddCorner(btn,6)
            local dropFrame = UI:Create("Frame",{Parent=frameDrop,Size=UDim2.new(1,0,0,#options*25),Position=UDim2.new(0,0,1,0),BackgroundColor3=UI.Theme.Secondary,Visible=false})
            UI:AddCorner(dropFrame,6)
            for i,opt in ipairs(options) do
                local optBtn = UI:Create("TextButton",{Parent=dropFrame,Size=UDim2.new(1,0,0,25),Position=UDim2.new(0,0,0,(i-1)*25),Text=opt,Font=Enum.Font.Gotham,TextSize=14,TextColor3=UI.Theme.Text,BackgroundTransparency=1})
                optBtn.MouseEnter:Connect(function() UI:Tween(optBtn,{BackgroundTransparency=0.5},0.1) end)
                optBtn.MouseLeave:Connect(function() UI:Tween(optBtn,{BackgroundTransparency=1},0.1) end)
                optBtn.MouseButton1Click:Connect(function()
                    btn.Text=opt
                    dropFrame.Visible=false
                    if callback then pcall(callback,opt) end
                end)
            end
            btn.MouseButton1Click:Connect(function()
                dropFrame.Visible=not dropFrame.Visible
            end)
            return frameDrop
        end

        
        function tabAPI:MultiSelect(text,options,callback)
            local frameMS = UI:Create("Frame",{Parent=tabContent,Size=UDim2.new(1,-10,0,35),Position=UDim2.new(0,5,0,#tabContent:GetChildren()*45),BackgroundTransparency=1})
            local lbl = UI:Create("TextLabel",{Parent=frameMS,Size=UDim2.new(0.7,0,1,0),Position=UDim2.new(0,0,0,0),Text=text,TextColor3=UI.Theme.Text,BackgroundTransparency=1,Font=Enum.Font.Gotham,TextSize=16,TextXAlignment=Enum.TextXAlignment.Left})
            local btn = UI:Create("TextButton",{Parent=frameMS,Size=UDim2.new(0.25,0,0.6,0),Position=UDim2.new(0.74,0,0.2,0),Text="Select",TextColor3=UI.Theme.Text,Font=Enum.Font.GothamBold,TextSize=14,BackgroundColor3=UI.Theme.Main})
            UI:AddCorner(btn,6)
            local dropFrame = UI:Create("Frame",{Parent=frameMS,Size=UDim2.new(1,0,0,#options*25),Position=UDim2.new(0,0,1,0),BackgroundColor3=UI.Theme.Secondary,Visible=false})
            UI:AddCorner(dropFrame,6)
            local selected={}
            for i,opt in ipairs(options) do
                local optBtn = UI:Create("TextButton",{Parent=dropFrame,Size=UDim2.new(1,0,0,25),Position=UDim2.new(0,0,0,(i-1)*25),Text=opt,Font=Enum.Font.Gotham,TextSize=14,TextColor3=UI.Theme.Text,BackgroundTransparency=1})
                optBtn.MouseEnter:Connect(function() UI:Tween(optBtn,{BackgroundTransparency=0.5},0.1) end)
                optBtn.MouseLeave:Connect(function() UI:Tween(optBtn,{BackgroundTransparency=1},0.1) end)
                optBtn.MouseButton1Click:Connect(function()
                    if table.find(selected,opt) then
                        for i,v in pairs(selected) do if v==opt then table.remove(selected,i) end end
                        optBtn.Text=opt
                    else
                        table.insert(selected,opt)
                        optBtn.Text=opt.." âœ“"
                    end
                    if callback then pcall(callback,selected) end
                end)
            end
            btn.MouseButton1Click:Connect(function()
                dropFrame.Visible=not dropFrame.Visible
            end)
            return frameMS
        end

        return tabAPI
    end

    
    if UI.Theme.Rainbow then
        spawn(function()
            while frame.Parent do
                for h=0,1,0.01 do
                    local col = Color3.fromHSV(h,0.8,1)
                    for _,btn in pairs(tabButtons) do
                        btn.BackgroundColor3 = col
                    end
                    TweenService:Create(titleBar,TweenInfo.new(0.1),{BackgroundColor3=col}):Play()
                    RunService.RenderStepped:Wait()
                end
            end
        end)
    end

    return frame
end

return UI
