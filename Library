-- Hiklo's Fixed UI Library
-- Compatible with both PC and Mobile
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local UILibrary = {}
UILibrary.__index = UILibrary

-- Enhanced colors with better contrast
local Colors = {
    Background = Color3.fromRGB(15, 15, 18),
    Foreground = Color3.fromRGB(25, 25, 28),
    Primary = Color3.fromRGB(0, 120, 255),
    Text = Color3.fromRGB(240, 240, 245),
    SubText = Color3.fromRGB(140, 140, 150),
    Close = Color3.fromRGB(255, 60, 60),
    Minimize = Color3.fromRGB(255, 180, 40),
    Selected = Color3.fromRGB(40, 100, 220),
    Button = Color3.fromRGB(35, 35, 40),
    Border = Color3.fromRGB(50, 50, 55),
    Success = Color3.fromRGB(40, 200, 80),
    Warning = Color3.fromRGB(255, 180, 40),
    Error = Color3.fromRGB(255, 80, 80),
    Info = Color3.fromRGB(0, 120, 255),
    Checkbox = Color3.fromRGB(60, 180, 60),
    Dropdown = Color3.fromRGB(30, 30, 35)
}

-- Improved tween function with better error handling
local function Tween(obj, props, duration, easingStyle)
    local tweenInfo = TweenInfo.new(duration or 0.25, easingStyle or Enum.EasingStyle.Quint)
    local tween = TweenService:Create(obj, tweenInfo, props)
    tween:Play()
    return tween
end

-- Screen Gui Manager for proper z-index handling
local ScreenGuiManager = {
    MainZIndex = 100,
    DropdownZIndex = 200,
    NotificationZIndex = 300
}

-- Notification System
local NotificationManager = {}
NotificationManager.__index = NotificationManager

function NotificationManager.new(screenGui)
    local self = setmetatable({}, NotificationManager)
    self.ScreenGui = screenGui
    self.Notifications = {}
    self.NotificationId = 0
    
    -- Create container
    self.Container = Instance.new("Frame")
    self.Container.Name = "NotificationContainer"
    self.Container.Size = UDim2.new(0, 320, 1, 0)
    self.Container.Position = UDim2.new(1, -340, 0, 0)
    self.Container.BackgroundTransparency = 1
    self.Container.ZIndex = ScreenGuiManager.NotificationZIndex
    self.Container.Parent = screenGui
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.Padding = UDim.new(0, 10)
    listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    listLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Parent = self.Container
    
    return self
end

function NotificationManager:CreateNotification(title, content, notificationType, duration)
    self.NotificationId = self.NotificationId + 1
    local notificationId = self.NotificationId
    
    -- Create notification frame
    local notification = Instance.new("Frame")
    notification.Name = "Notification_" .. notificationId
    notification.Size = UDim2.new(0, 300, 0, 0)
    notification.BackgroundColor3 = Colors.Foreground
    notification.BackgroundTransparency = 1
    notification.ClipsDescendants = true
    notification.LayoutOrder = notificationId
    notification.ZIndex = ScreenGuiManager.NotificationZIndex + 1
    notification.Parent = self.Container
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = notification
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Colors.Border
    stroke.Thickness = 1
    stroke.Transparency = 0.5
    stroke.Parent = notification
    
    -- Type indicator
    local typeIndicator = Instance.new("Frame")
    typeIndicator.Size = UDim2.new(0, 4, 1, 0)
    typeIndicator.BackgroundColor3 = Colors[notificationType] or Colors.Info
    typeIndicator.BorderSizePixel = 0
    typeIndicator.ZIndex = notification.ZIndex + 1
    typeIndicator.Parent = notification
    
    local typeCorner = Instance.new("UICorner")
    typeCorner.CornerRadius = UDim.new(0, 2)
    typeCorner.Parent = typeIndicator
    
    -- Content
    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, -20, 1, 0)
    contentFrame.Position = UDim2.new(0, 12, 0, 0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ZIndex = notification.ZIndex + 1
    contentFrame.Parent = notification
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 0, 24)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "Notification"
    titleLabel.TextColor3 = Colors.Text
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.TextTruncate = Enum.TextTruncate.AtEnd
    titleLabel.ZIndex = notification.ZIndex + 2
    titleLabel.Parent = contentFrame
    
    local contentLabel = Instance.new("TextLabel")
    contentLabel.Size = UDim2.new(1, 0, 0, 0)
    contentLabel.Position = UDim2.new(0, 0, 0, 24)
    contentLabel.BackgroundTransparency = 1
    contentLabel.Text = content or ""
    contentLabel.TextColor3 = Colors.SubText
    contentLabel.TextSize = 12
    contentLabel.Font = Enum.Font.Gotham
    contentLabel.TextXAlignment = Enum.TextXAlignment.Left
    contentLabel.TextYAlignment = Enum.TextYAlignment.Top
    contentLabel.TextWrapped = true
    contentLabel.TextTruncate = Enum.TextTruncate.AtEnd
    contentLabel.ZIndex = notification.ZIndex + 2
    contentLabel.Parent = contentFrame
    
    -- Calculate text height
    local textHeight = math.min(contentLabel.TextBounds.Y, 60)
    contentLabel.Size = UDim2.new(1, 0, 0, textHeight)
    
    local notificationHeight = 24 + textHeight + 12
    notification.Size = UDim2.new(0, 300, 0, notificationHeight)
    
    -- Close button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 20, 0, 20)
    closeBtn.Position = UDim2.new(1, -24, 0, 8)
    closeBtn.BackgroundColor3 = Colors.Button
    closeBtn.AutoButtonColor = false
    closeBtn.TextColor3 = Colors.Text
    closeBtn.TextSize = 14
    closeBtn.Text = "×"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.ZIndex = notification.ZIndex + 2
    closeBtn.Parent = notification
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 4)
    closeCorner.Parent = closeBtn
    
    -- Progress bar
    local progressBar = Instance.new("Frame")
    progressBar.Size = UDim2.new(1, 0, 0, 2)
    progressBar.Position = UDim2.new(0, 0, 1, -2)
    progressBar.BackgroundColor3 = Colors[notificationType] or Colors.Info
    progressBar.BorderSizePixel = 0
    progressBar.ZIndex = notification.ZIndex + 1
    progressBar.Parent = notification
    
    local progressCorner = Instance.new("UICorner")
    progressCorner.CornerRadius = UDim.new(0, 1)
    progressCorner.Parent = progressBar
    
    -- Animate in
    notification.Position = UDim2.new(1, 0, 0, 0)
    Tween(notification, {Position = UDim2.new(0, 0, 0, 0), BackgroundTransparency = 0})
    
    local function close()
        Tween(notification, {
            Position = UDim2.new(1, 0, 0, 0),
            BackgroundTransparency = 1
        })
        
        wait(0.25)
        if notification and notification.Parent then
            notification:Destroy()
        end
        self.Notifications[notificationId] = nil
    end
    
    closeBtn.MouseButton1Click:Connect(close)
    closeBtn.MouseButton2Click:Connect(close)
    
    -- Hover effects
    closeBtn.MouseEnter:Connect(function()
        Tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(50, 50, 55)})
    end)
    
    closeBtn.MouseLeave:Connect(function()
        Tween(closeBtn, {BackgroundColor3 = Colors.Button})
    end)
    
    -- Auto close timer
    local startTime = tick()
    local connection
    connection = RunService.Heartbeat:Connect(function()
        local elapsed = tick() - startTime
        local progress = 1 - (elapsed / (duration or 5))
        
        if progress <= 0 then
            connection:Disconnect()
            close()
            return
        end
        
        progressBar.Size = UDim2.new(progress, 0, 0, 2)
    end)
    
    self.Notifications[notificationId] = {
        Frame = notification,
        Close = close,
        Connection = connection
    }
    
    return {
        Close = close
    }
end

-- Main UI Library
function UILibrary:Create(title)
    local self = setmetatable({}, UILibrary)
    
    -- Create main ScreenGui
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "UILibrary_" .. math.random(1000, 9999)
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui.Parent = CoreGui
    
    -- Create notification manager
    self.Notifications = NotificationManager.new(self.ScreenGui)
    
    -- Create main window
    self.Window = Instance.new("Frame")
    self.Window.Size = UDim2.new(0, 450, 0, 340)
    self.Window.Position = UDim2.new(0.5, -225, 0.5, -170)
    self.Window.BackgroundColor3 = Colors.Background
    self.Window.BorderSizePixel = 0
    self.Window.ClipsDescendants = true
    self.Window.ZIndex = ScreenGuiManager.MainZIndex
    self.Window.Parent = self.ScreenGui
    
    local windowCorner = Instance.new("UICorner")
    windowCorner.CornerRadius = UDim.new(0, 14)
    windowCorner.Parent = self.Window
    
    local windowStroke = Instance.new("UIStroke")
    windowStroke.Color = Colors.Border
    windowStroke.Thickness = 1
    windowStroke.Transparency = 0.5
    windowStroke.Parent = self.Window
    
    -- Top bar
    self.TopBar = Instance.new("Frame")
    self.TopBar.Size = UDim2.new(1, 0, 0, 42)
    self.TopBar.BackgroundColor3 = Colors.Foreground
    self.TopBar.BorderSizePixel = 0
    self.TopBar.ZIndex = self.Window.ZIndex + 1
    self.TopBar.Parent = self.Window
    
    local topCorner = Instance.new("UICorner")
    topCorner.CornerRadius = UDim.new(0, 14, 0, 0)
    topCorner.Parent = self.TopBar
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(0, 220, 1, 0)
    titleLabel.Position = UDim2.new(0, 15, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "UI Library"
    titleLabel.TextColor3 = Colors.Text
    titleLabel.TextSize = 16
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.ZIndex = self.TopBar.ZIndex + 1
    titleLabel.Parent = self.TopBar
    
    -- Close button
    self.CloseBtn = Instance.new("TextButton")
    self.CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    self.CloseBtn.Position = UDim2.new(1, -38, 0.5, -15)
    self.CloseBtn.BackgroundColor3 = Colors.Close
    self.CloseBtn.AutoButtonColor = false
    self.CloseBtn.TextColor3 = Colors.Text
    self.CloseBtn.TextSize = 20
    self.CloseBtn.Text = "×"
    self.CloseBtn.Font = Enum.Font.GothamBold
    self.CloseBtn.ZIndex = self.TopBar.ZIndex + 1
    self.CloseBtn.Parent = self.TopBar
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 8)
    closeCorner.Parent = self.CloseBtn
    
    -- Minimize button
    self.MinimizeBtn = Instance.new("TextButton")
    self.MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)
    self.MinimizeBtn.Position = UDim2.new(1, -76, 0.5, -15)
    self.MinimizeBtn.BackgroundColor3 = Colors.Minimize
    self.MinimizeBtn.AutoButtonColor = false
    self.MinimizeBtn.TextColor3 = Colors.Text
    self.MinimizeBtn.TextSize = 20
    self.MinimizeBtn.Text = "-"
    self.MinimizeBtn.Font = Enum.Font.GothamBold
    self.MinimizeBtn.ZIndex = self.TopBar.ZIndex + 1
    self.MinimizeBtn.Parent = self.TopBar
    
    local minCorner = Instance.new("UICorner")
    minCorner.CornerRadius = UDim.new(0, 8)
    minCorner.Parent = self.MinimizeBtn
    
    -- Left panel for tabs
    self.LeftPanel = Instance.new("Frame")
    self.LeftPanel.Size = UDim2.new(0, 120, 1, -42)
    self.LeftPanel.Position = UDim2.new(0, 0, 0, 42)
    self.LeftPanel.BackgroundColor3 = Colors.Foreground
    self.LeftPanel.ZIndex = self.Window.ZIndex + 1
    self.LeftPanel.Parent = self.Window
    
    local leftCorner = Instance.new("UICorner")
    leftCorner.CornerRadius = UDim.new(0, 14)
    leftCorner.Parent = self.LeftPanel
    
    self.TabsContainer = Instance.new("ScrollingFrame")
    self.TabsContainer.Size = UDim2.new(1, 0, 1, 0)
    self.TabsContainer.BackgroundTransparency = 1
    self.TabsContainer.BorderSizePixel = 0
    self.TabsContainer.ScrollBarThickness = 6
    self.TabsContainer.ScrollBarImageColor3 = Colors.Primary
    self.TabsContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.TabsContainer.ZIndex = self.LeftPanel.ZIndex + 1
    self.TabsContainer.Parent = self.LeftPanel
    
    local tabsList = Instance.new("UIListLayout")
    tabsList.Padding = UDim.new(0, 8)
    tabsList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabsList.Parent = self.TabsContainer
    
    local tabsPadding = Instance.new("UIPadding")
    tabsPadding.PaddingTop = UDim.new(0, 10)
    tabsPadding.PaddingBottom = UDim.new(0, 10)
    tabsPadding.PaddingLeft = UDim.new(0, 10)
    tabsPadding.PaddingRight = UDim.new(0, 10)
    tabsPadding.Parent = self.TabsContainer
    
    -- Content panel
    self.ContentPanel = Instance.new("Frame")
    self.ContentPanel.Size = UDim2.new(1, -120, 1, -42)
    self.ContentPanel.Position = UDim2.new(0, 120, 0, 42)
    self.ContentPanel.BackgroundColor3 = Colors.Background
    self.ContentPanel.ZIndex = self.Window.ZIndex + 1
    self.ContentPanel.Parent = self.Window
    
    local contentCorner = Instance.new("UICorner")
    contentCorner.CornerRadius = UDim.new(0, 14)
    contentCorner.Parent = self.ContentPanel
    
    self.Content = Instance.new("ScrollingFrame")
    self.Content.Size = UDim2.new(1, 0, 1, 0)
    self.Content.BackgroundTransparency = 1
    self.Content.BorderSizePixel = 0
    self.Content.ScrollBarThickness = 6
    self.Content.ScrollBarImageColor3 = Colors.Primary
    self.Content.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.Content.ScrollingEnabled = true
    self.Content.ZIndex = self.ContentPanel.ZIndex + 1
    self.Content.Parent = self.ContentPanel
    
    local contentList = Instance.new("UIListLayout")
    contentList.Padding = UDim.new(0, 12)
    contentList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    contentList.SortOrder = Enum.SortOrder.LayoutOrder
    contentList.Parent = self.Content
    
    local contentPadding = Instance.new("UIPadding")
    contentPadding.PaddingTop = UDim.new(0, 12)
    contentPadding.PaddingBottom = UDim.new(0, 12)
    contentPadding.PaddingLeft = UDim.new(0, 12)
    contentPadding.PaddingRight = UDim.new(0, 12)
    contentPadding.Parent = self.Content
    
    -- Drag functionality
    local dragEnabled = false
    local dragInput, dragStart, startPos
    
    local function update(input)
        if not dragEnabled then return end
        local delta = input.Position - dragStart
        self.Window.Position = UDim2.new(
            startPos.X.Scale, 
            startPos.X.Offset + delta.X, 
            startPos.Y.Scale, 
            startPos.Y.Offset + delta.Y
        )
    end
    
    self.TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragEnabled = true
            dragStart = input.Position
            startPos = self.Window.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragEnabled = false
                end
            end)
        end
    end)
    
    self.TopBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragEnabled then
            update(input)
        end
    end)
    
    -- Button hover effects
    self.CloseBtn.MouseEnter:Connect(function()
        Tween(self.CloseBtn, {BackgroundColor3 = Color3.fromRGB(255, 80, 80)})
    end)
    
    self.CloseBtn.MouseLeave:Connect(function()
        Tween(self.CloseBtn, {BackgroundColor3 = Colors.Close})
    end)
    
    self.MinimizeBtn.MouseEnter:Connect(function()
        Tween(self.MinimizeBtn, {BackgroundColor3 = Color3.fromRGB(255, 200, 60)})
    end)
    
    self.MinimizeBtn.MouseLeave:Connect(function()
        Tween(self.MinimizeBtn, {BackgroundColor3 = Colors.Minimize})
    end)
    
    -- Minimize functionality
    local minimized = false
    self.MinimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        if minimized then
            self.LeftPanel.Visible = false
            self.ContentPanel.Visible = false
            Tween(self.Window, {Size = UDim2.new(0, 450, 0, 42)})
            self.MinimizeBtn.Text = "+"
        else
            self.LeftPanel.Visible = true
            self.ContentPanel.Visible = true
            Tween(self.Window, {Size = UDim2.new(0, 450, 0, 340)})
            self.MinimizeBtn.Text = "-"
        end
    end)
    
    -- Close functionality
    self.CloseBtn.MouseButton1Click:Connect(function()
        Tween(self.Window, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        })
        wait(0.3)
        self.ScreenGui:Destroy()
    end)
    
    -- Tab management
    self.Tabs = {}
    self.CurrentTab = nil
    self.CurrentTabButton = nil
    
    -- Tab function
    function self:Tab(name, icon)
        local tabBtn = Instance.new("TextButton")
        tabBtn.Size = UDim2.new(1, 0, 0, 36)
        tabBtn.BackgroundColor3 = Colors.Button
        tabBtn.AutoButtonColor = false
        tabBtn.Text = ""
        tabBtn.ZIndex = self.TabsContainer.ZIndex + 1
        tabBtn.Parent = self.TabsContainer
        
        local tabCorner = Instance.new("UICorner")
        tabCorner.CornerRadius = UDim.new(0, 8)
        tabCorner.Parent = tabBtn
        
        local tabStroke = Instance.new("UIStroke")
        tabStroke.Thickness = 1
        tabStroke.Color = Colors.Border
        tabStroke.Parent = tabBtn
        
        local tabContent = Instance.new("Frame")
        tabContent.Size = UDim2.new(1, -10, 1, -10)
        tabContent.Position = UDim2.new(0, 5, 0, 5)
        tabContent.BackgroundTransparency = 1
        tabContent.ZIndex = tabBtn.ZIndex + 1
        tabContent.Parent = tabBtn
        
        local tabLayout = Instance.new("UIListLayout")
        tabLayout.FillDirection = Enum.FillDirection.Horizontal
        tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        tabLayout.VerticalAlignment = Enum.VerticalAlignment.Center
        tabLayout.Padding = UDim.new(0, 5)
        tabLayout.Parent = tabContent
        
        -- Icon if provided
        local iconImage = nil
        if icon then
            iconImage = Instance.new("ImageLabel")
            iconImage.Size = UDim2.new(0, 20, 0, 20)
            iconImage.BackgroundTransparency = 1
            iconImage.Image = icon
            iconImage.ImageColor3 = Colors.SubText
            iconImage.ZIndex = tabContent.ZIndex + 1
            iconImage.Parent = tabContent
        end
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(0, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = name
        textLabel.TextColor3 = Colors.SubText
        textLabel.Font = Enum.Font.GothamSemibold
        textLabel.TextSize = 14
        textLabel.AutomaticSize = Enum.AutomaticSize.X
        textLabel.ZIndex = tabContent.ZIndex + 1
        textLabel.Parent = tabContent
        
        -- Content frame for this tab
        local contentFrame = Instance.new("ScrollingFrame")
        contentFrame.Size = UDim2.new(1, 0, 1, 0)
        contentFrame.BackgroundTransparency = 1
        contentFrame.BorderSizePixel = 0
        contentFrame.ScrollBarThickness = 6
        contentFrame.ScrollBarImageColor3 = Colors.Primary
        contentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
        contentFrame.Visible = false
        contentFrame.ZIndex = self.Content.ZIndex + 1
        contentFrame.Parent = self.Content
        
        local tabContentList = Instance.new("UIListLayout")
        tabContentList.Padding = UDim.new(0, 12)
        tabContentList.HorizontalAlignment = Enum.HorizontalAlignment.Center
        tabContentList.SortOrder = Enum.SortOrder.LayoutOrder
        tabContentList.Parent = contentFrame
        
        local tabContentPadding = Instance.new("UIPadding")
        tabContentPadding.PaddingTop = UDim.new(0, 12)
        tabContentPadding.PaddingBottom = UDim.new(0, 12)
        tabContentPadding.PaddingLeft = UDim.new(0, 12)
        tabContentPadding.PaddingRight = UDim.new(0, 12)
        tabContentPadding.Parent = contentFrame
        
        -- Tab button hover effects
        tabBtn.MouseEnter:Connect(function()
            if self.CurrentTabButton ~= tabBtn then
                Tween(tabBtn, {BackgroundColor3 = Color3.fromRGB(40, 40, 45)})
                Tween(textLabel, {TextColor3 = Colors.Text})
                if iconImage then
                    Tween(iconImage, {ImageColor3 = Colors.Text})
                end
            end
        end)
        
        tabBtn.MouseLeave:Connect(function()
            if self.CurrentTabButton ~= tabBtn then
                Tween(tabBtn, {BackgroundColor3 = Colors.Button})
                Tween(textLabel, {TextColor3 = Colors.SubText})
                if iconImage then
                    Tween(iconImage, {ImageColor3 = Colors.SubText})
                end
            end
        end)
        
        -- Tab click functionality
        tabBtn.MouseButton1Click:Connect(function()
            if self.CurrentTab then
                self.CurrentTab.Visible = false
            end
            
            if self.CurrentTabButton then
                local prevContent = self.CurrentTabButton:FindFirstChild("Frame")
                if prevContent then
                    local prevLabel = prevContent:FindFirstChildWhichIsA("TextLabel")
                    local prevIcon = prevContent:FindFirstChildWhichIsA("ImageLabel")
                    
                    Tween(self.CurrentTabButton, {BackgroundColor3 = Colors.Button})
                    
                    if prevLabel then
                        Tween(prevLabel, {TextColor3 = Colors.SubText})
                    end
                    if prevIcon then
                        Tween(prevIcon, {ImageColor3 = Colors.SubText})
                    end
                end
            end
            
            Tween(tabBtn, {BackgroundColor3 = Colors.Selected})
            Tween(textLabel, {TextColor3 = Colors.Text})
            if iconImage then
                Tween(iconImage, {ImageColor3 = Colors.Text})
            end
            
            contentFrame.Visible = true
            self.CurrentTab = contentFrame
            self.CurrentTabButton = tabBtn
        end)
        
        -- Tab data table with component functions
        local tabData = {}
        
        -- Button component
        function tabData:AddButton(text, callback, btnIcon)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, 0, 0, 38)
            btn.BackgroundColor3 = Colors.Button
            btn.AutoButtonColor = false
            btn.Text = ""
            btn.ZIndex = contentFrame.ZIndex + 1
            btn.Parent = contentFrame
            
            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 8)
            btnCorner.Parent = btn
            
            local btnStroke = Instance.new("UIStroke")
            btnStroke.Thickness = 1
            btnStroke.Color = Colors.Border
            btnStroke.Parent = btn
            
            local btnContent = Instance.new("Frame")
            btnContent.Size = UDim2.new(1, -20, 1, 0)
            btnContent.Position = UDim2.new(0, 10, 0, 0)
            btnContent.BackgroundTransparency = 1
            btnContent.ZIndex = btn.ZIndex + 1
            btnContent.Parent = btn
            
            local btnLayout = Instance.new("UIListLayout")
            btnLayout.FillDirection = Enum.FillDirection.Horizontal
            btnLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
            btnLayout.VerticalAlignment = Enum.VerticalAlignment.Center
            btnLayout.Padding = UDim.new(0, 8)
            btnLayout.Parent = btnContent
            
            -- Button icon
            if btnIcon then
                local iconImage = Instance.new("ImageLabel")
                iconImage.Size = UDim2.new(0, 20, 0, 20)
                iconImage.BackgroundTransparency = 1
                iconImage.Image = btnIcon
                iconImage.ImageColor3 = Colors.Text
                iconImage.ZIndex = btnContent.ZIndex + 1
                iconImage.Parent = btnContent
            end
            
            local btnTextLabel = Instance.new("TextLabel")
            btnTextLabel.Size = UDim2.new(0, 0, 1, 0)
            btnTextLabel.BackgroundTransparency = 1
            btnTextLabel.Text = text
            btnTextLabel.TextColor3 = Colors.Text
            btnTextLabel.Font = Enum.Font.GothamBold
            btnTextLabel.TextSize = 14
            btnTextLabel.AutomaticSize = Enum.AutomaticSize.X
            btnTextLabel.ZIndex = btnContent.ZIndex + 1
            btnTextLabel.Parent = btnContent
            
            -- Click animation and callback
            btn.MouseButton1Click:Connect(function()
                Tween(btn, {BackgroundColor3 = Color3.fromRGB(50, 50, 55)})
                task.wait(0.1)
                Tween(btn, {BackgroundColor3 = Colors.Button})
                if callback then
                    callback()
                end
            end)
            
            btn.MouseEnter:Connect(function()
                Tween(btn, {BackgroundColor3 = Color3.fromRGB(40, 40, 45)})
            end)
            
            btn.MouseLeave:Connect(function()
                Tween(btn, {BackgroundColor3 = Colors.Button})
            end)
            
            return btn
        end
        
        -- Toggle component
        function tabData:AddToggle(text, default, callback, toggleIcon)
            local toggleFrame = Instance.new("Frame")
            toggleFrame.Size = UDim2.new(1, 0, 0, 38)
            toggleFrame.BackgroundColor3 = Colors.Foreground
            toggleFrame.ZIndex = contentFrame.ZIndex + 1
            toggleFrame.Parent = contentFrame
            
            local toggleCorner = Instance.new("UICorner")
            toggleCorner.CornerRadius = UDim.new(0, 8)
            toggleCorner.Parent = toggleFrame
            
            local toggleStroke = Instance.new("UIStroke")
            toggleStroke.Thickness = 1
            toggleStroke.Color = Colors.Border
            toggleStroke.Parent = toggleFrame
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -60, 1, 0)
            label.Position = UDim2.new(0, 14, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Colors.Text
            label.TextSize = 14
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = toggleFrame.ZIndex + 1
            label.Parent = toggleFrame
            
            -- Toggle icon
            if toggleIcon then
                local iconImage = Instance.new("ImageLabel")
                iconImage.Size = UDim2.new(0, 20, 0, 20)
                iconImage.Position = UDim2.new(0, 14, 0.5, -10)
                iconImage.BackgroundTransparency = 1
                iconImage.Image = toggleIcon
                iconImage.ImageColor3 = Colors.Text
                iconImage.ZIndex = toggleFrame.ZIndex + 1
                iconImage.Parent = toggleFrame
                
                label.Position = UDim2.new(0, 44, 0, 0)
                label.Size = UDim2.new(1, -90, 1, 0)
            end
            
            local switch = Instance.new("Frame")
            switch.Size = UDim2.new(0, 44, 0, 24)
            switch.Position = UDim2.new(1, -48, 0.5, -12)
            switch.BackgroundColor3 = Colors.Button
            switch.ZIndex = toggleFrame.ZIndex + 1
            switch.Parent = toggleFrame
            
            local switchCorner = Instance.new("UICorner")
            switchCorner.CornerRadius = UDim.new(1, 0)
            switchCorner.Parent = switch
            
            local dot = Instance.new("Frame")
            dot.Size = UDim2.new(0, 20, 0, 20)
            dot.Position = default and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
            dot.BackgroundColor3 = default and Colors.Selected or Color3.fromRGB(200, 200, 210)
            dot.ZIndex = switch.ZIndex + 1
            dot.Parent = switch
            
            local dotCorner = Instance.new("UICorner")
            dotCorner.CornerRadius = UDim.new(1, 0)
            dotCorner.Parent = dot
            
            local state = default or false
            
            local function toggle()
                state = not state
                if state then
                    Tween(dot, {
                        Position = UDim2.new(1, -22, 0.5, -10),
                        BackgroundColor3 = Colors.Selected
                    })
                else
                    Tween(dot, {
                        Position = UDim2.new(0, 2, 0.5, -10),
                        BackgroundColor3 = Color3.fromRGB(200, 200, 210)
                    })
                end
                if callback then
                    callback(state)
                end
            end
            
            local clickBtn = Instance.new("TextButton")
            clickBtn.Size = UDim2.new(1, 0, 1, 0)
            clickBtn.BackgroundTransparency = 1
            clickBtn.Text = ""
            clickBtn.ZIndex = toggleFrame.ZIndex + 2
            clickBtn.Parent = toggleFrame
            
            clickBtn.MouseButton1Click:Connect(toggle)
            
            local toggleObj = {}
            
            function toggleObj:Set(value)
                if state ~= value then
                    toggle()
                end
            end
            
            function toggleObj:Get()
                return state
            end
            
            return toggleObj
        end
        
        -- Dropdown component (FIXED VERSION)
        function tabData:AddDropdown(text, options, callback, dropdownIcon)
            local dropdownFrame = Instance.new("Frame")
            dropdownFrame.Size = UDim2.new(1, 0, 0, 38)
            dropdownFrame.BackgroundColor3 = Colors.Foreground
            dropdownFrame.ClipsDescendants = false
            dropdownFrame.ZIndex = contentFrame.ZIndex + 1
            dropdownFrame.Parent = contentFrame
            
            local dropdownCorner = Instance.new("UICorner")
            dropdownCorner.CornerRadius = UDim.new(0, 8)
            dropdownCorner.Parent = dropdownFrame
            
            local dropdownStroke = Instance.new("UIStroke")
            dropdownStroke.Thickness = 1
            dropdownStroke.Color = Colors.Border
            dropdownStroke.Parent = dropdownFrame
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -60, 1, 0)
            label.Position = UDim2.new(0, 14, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Colors.Text
            label.TextSize = 14
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = dropdownFrame.ZIndex + 1
            label.Parent = dropdownFrame
            
            -- Dropdown icon
            if dropdownIcon then
                local iconImage = Instance.new("ImageLabel")
                iconImage.Size = UDim2.new(0, 20, 0, 20)
                iconImage.Position = UDim2.new(0, 14, 0.5, -10)
                iconImage.BackgroundTransparency = 1
                iconImage.Image = dropdownIcon
                iconImage.ImageColor3 = Colors.Text
                iconImage.ZIndex = dropdownFrame.ZIndex + 1
                iconImage.Parent = dropdownFrame
                
                label.Position = UDim2.new(0, 44, 0, 0)
                label.Size = UDim2.new(1, -90, 1, 0)
            end
            
            local arrowBtn = Instance.new("TextButton")
            arrowBtn.Size = UDim2.new(0, 36, 0, 36)
            arrowBtn.Position = UDim2.new(1, -42, 0.5, -18)
            arrowBtn.BackgroundColor3 = Colors.Button
            arrowBtn.AutoButtonColor = false
            arrowBtn.Text = "▼"
            arrowBtn.TextColor3 = Colors.Text
            arrowBtn.Font = Enum.Font.GothamBold
            arrowBtn.TextSize = 14
            arrowBtn.ZIndex = dropdownFrame.ZIndex + 1
            arrowBtn.Parent = dropdownFrame
            
            local arrowCorner = Instance.new("UICorner")
            arrowCorner.CornerRadius = UDim.new(0, 8)
            arrowCorner.Parent = arrowBtn
            
            -- Create options frame as a child of the ScreenGui for proper z-index
            local optionsFrame = Instance.new("Frame")
            optionsFrame.Size = UDim2.new(0, 0, 0, 0)
            optionsFrame.BackgroundColor3 = Colors.Dropdown
            optionsFrame.ClipsDescendants = true
            optionsFrame.Visible = false
            optionsFrame.ZIndex = ScreenGuiManager.DropdownZIndex
            optionsFrame.Parent = self.ScreenGui
            
            local optionsCorner = Instance.new("UICorner")
            optionsCorner.CornerRadius = UDim.new(0, 8)
            optionsCorner.Parent = optionsFrame
            
            local optionsStroke = Instance.new("UIStroke")
            optionsStroke.Thickness = 1
            optionsStroke.Color = Colors.Border
            optionsStroke.Parent = optionsFrame
            
            local optionsScrolling = Instance.new("ScrollingFrame")
            optionsScrolling.Size = UDim2.new(1, 0, 1, 0)
            optionsScrolling.BackgroundTransparency = 1
            optionsScrolling.BorderSizePixel = 0
            optionsScrolling.ScrollBarThickness = 6
            optionsScrolling.ScrollBarImageColor3 = Colors.Primary
            optionsScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
            optionsScrolling.ZIndex = optionsFrame.ZIndex + 1
            optionsScrolling.Parent = optionsFrame
            
            local optionsLayout = Instance.new("UIListLayout")
            optionsLayout.Padding = UDim.new(0, 4)
            optionsLayout.Parent = optionsScrolling
            
            local optionsPadding = Instance.new("UIPadding")
            optionsPadding.PaddingTop = UDim.new(0, 4)
            optionsPadding.PaddingBottom = UDim.new(0, 4)
            optionsPadding.PaddingLeft = UDim.new(0, 4)
            optionsPadding.PaddingRight = UDim.new(0, 4)
            optionsPadding.Parent = optionsScrolling
            
            local open = false
            local selectedOption = nil
            local optionButtons = {}
            
            local function updateOptionsPosition()
                local dropdownAbsPos = dropdownFrame.AbsolutePosition
                local dropdownAbsSize = dropdownFrame.AbsoluteSize
                local screenSize = workspace.CurrentCamera.ViewportSize
                
                -- Calculate available space
                local spaceBelow = screenSize.Y - (dropdownAbsPos.Y + dropdownAbsSize.Y + 4)
                local spaceAbove = dropdownAbsPos.Y - 4
                local totalHeight = math.min(optionsLayout.AbsoluteContentSize.Y + 8, 200)
                
                local positionY
                if spaceBelow >= totalHeight or spaceBelow >= spaceAbove then
                    -- Open below
                    positionY = dropdownAbsPos.Y + dropdownAbsSize.Y + 4
                else
                    -- Open above
                    positionY = dropdownAbsPos.Y - totalHeight - 4
                end
                
                optionsFrame.Position = UDim2.new(0, dropdownAbsPos.X, 0, positionY)
                optionsFrame.Size = UDim2.new(0, dropdownAbsSize.X, 0, 0)
            end
            
            local function createOption(optionText, optionIcon)
                local optBtn = Instance.new("TextButton")
                optBtn.Size = UDim2.new(1, -8, 0, 32)
                optBtn.BackgroundColor3 = Colors.Button
                optBtn.AutoButtonColor = false
                optBtn.Text = ""
                optBtn.ZIndex = optionsScrolling.ZIndex + 1
                optBtn.Parent = optionsScrolling
                
                local optCorner = Instance.new("UICorner")
                optCorner.CornerRadius = UDim.new(0, 6)
                optCorner.Parent = optBtn
                
                local optContent = Instance.new("Frame")
                optContent.Size = UDim2.new(1, -10, 1, -6)
                optContent.Position = UDim2.new(0, 5, 0, 3)
                optContent.BackgroundTransparency = 1
                optContent.ZIndex = optBtn.ZIndex + 1
                optContent.Parent = optBtn
                
                local optLayout = Instance.new("UIListLayout")
                optLayout.FillDirection = Enum.FillDirection.Horizontal
                optLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
                optLayout.VerticalAlignment = Enum.VerticalAlignment.Center
                optLayout.Padding = UDim.new(0, 6)
                optLayout.Parent = optContent
                
                -- Option icon
                if optionIcon then
                    local iconImg = Instance.new("ImageLabel")
                    iconImg.Size = UDim2.new(0, 18, 0, 18)
                    iconImg.BackgroundTransparency = 1
                    iconImg.Image = optionIcon
                    iconImg.ImageColor3 = Colors.Text
                    iconImg.ZIndex = optContent.ZIndex + 1
                    iconImg.Parent = optContent
                end
                
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(0, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.Text = optionText
                textLabel.TextColor3 = Colors.Text
                textLabel.Font = Enum.Font.GothamSemibold
                textLabel.TextSize = 13
                textLabel.TextXAlignment = Enum.TextXAlignment.Left
                textLabel.AutomaticSize = Enum.AutomaticSize.X
                textLabel.ZIndex = optContent.ZIndex + 1
                textLabel.Parent = optContent
                
                optBtn.MouseButton1Click:Connect(function()
                    selectedOption = optionText
                    label.Text = text .. ": " .. optionText
                    
                    for _, btn in ipairs(optionButtons) do
                        local btnText = btn:GetAttribute("OptionText")
                        if btnText == optionText then
                            Tween(btn, {BackgroundColor3 = Colors.Selected})
                        else
                            Tween(btn, {BackgroundColor3 = Colors.Button})
                        end
                    end
                    
                    closeDropdown()
                    
                    if callback then
                        callback(optionText)
                    end
                end)
                
                optBtn:SetAttribute("OptionText", optionText)
                table.insert(optionButtons, optBtn)
                
                return optBtn
            end
            
            -- Create options
            for _, opt in ipairs(options) do
                local optionText, optionIcon
                if type(opt) == "table" then
                    optionText = opt.Text or "Option"
                    optionIcon = opt.Icon
                else
                    optionText = tostring(opt)
                    optionIcon = nil
                end
                createOption(optionText, optionIcon)
            end
            
            local function openDropdown()
                if open then return end
                open = true
                
                updateOptionsPosition()
                optionsFrame.Visible = true
                Tween(arrowBtn, {Rotation = 180})
                
                local totalHeight = math.min(optionsLayout.AbsoluteContentSize.Y + 8, 200)
                Tween(optionsFrame, {Size = UDim2.new(0, dropdownFrame.AbsoluteSize.X, 0, totalHeight)})
                
                -- Highlight selected option
                if selectedOption then
                    for _, btn in ipairs(optionButtons) do
                        local btnText = btn:GetAttribute("OptionText")
                        if btnText == selectedOption then
                            Tween(btn, {BackgroundColor3 = Colors.Selected})
                        else
                            Tween(btn, {BackgroundColor3 = Colors.Button})
                        end
                    end
                end
            end
            
            local function closeDropdown()
                if not open then return end
                open = false
                
                Tween(optionsFrame, {Size = UDim2.new(0, dropdownFrame.AbsoluteSize.X, 0, 0)})
                Tween(arrowBtn, {Rotation = 0})
                
                wait(0.2)
                optionsFrame.Visible = false
            end
            
            arrowBtn.MouseButton1Click:Connect(function()
                if open then
                    closeDropdown()
                else
                    openDropdown()
                end
            end)
            
            -- Close dropdown when clicking outside
            local dropdownConnection
            dropdownConnection = UserInputService.InputBegan:Connect(function(input)
                if open and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
                    local mousePos = input.Position
                    local dropdownAbsPos = dropdownFrame.AbsolutePosition
                    local dropdownAbsSize = dropdownFrame.AbsoluteSize
                    local optionsAbsPos = optionsFrame.AbsolutePosition
                    local optionsAbsSize = optionsFrame.AbsoluteSize
                    
                    local isInDropdown = mousePos.X >= dropdownAbsPos.X and mousePos.X <= dropdownAbsPos.X + dropdownAbsSize.X and
                                        mousePos.Y >= dropdownAbsPos.Y and mousePos.Y <= dropdownAbsPos.Y + dropdownAbsSize.Y
                    
                    local isInOptions = mousePos.X >= optionsAbsPos.X and mousePos.X <= optionsAbsPos.X + optionsAbsSize.X and
                                       mousePos.Y >= optionsAbsPos.Y and mousePos.Y <= optionsAbsPos.Y + optionsAbsSize.Y
                    
                    if not isInDropdown and not isInOptions then
                        closeDropdown()
                    end
                end
            end)
            
            -- Clean up
            dropdownFrame.Destroying:Connect(function()
                if dropdownConnection then
                    dropdownConnection:Disconnect()
                end
                if optionsFrame then
                    optionsFrame:Destroy()
                end
            end)
            
            local dropdownObj = {}
            
            function dropdownObj:Set(option)
                for _, btn in ipairs(optionButtons) do
                    local btnText = btn:GetAttribute("OptionText")
                    if btnText == option then
                        selectedOption = option
                        label.Text = text .. ": " .. option
                        Tween(btn, {BackgroundColor3 = Colors.Selected})
                        if callback then
                            callback(option)
                        end
                    else
                        Tween(btn, {BackgroundColor3 = Colors.Button})
                    end
                end
            end
            
            function dropdownObj:Get()
                return selectedOption
            end
            
            return dropdownObj
        end
        
        -- Multi-Dropdown component (FIXED VERSION)
        function tabData:AddMultiDropdown(text, options, callback, multiIcon)
            local multiFrame = Instance.new("Frame")
            multiFrame.Size = UDim2.new(1, 0, 0, 38)
            multiFrame.BackgroundColor3 = Colors.Foreground
            multiFrame.ClipsDescendants = false
            multiFrame.ZIndex = contentFrame.ZIndex + 1
            multiFrame.Parent = contentFrame
            
            local multiCorner = Instance.new("UICorner")
            multiCorner.CornerRadius = UDim.new(0, 8)
            multiCorner.Parent = multiFrame
            
            local multiStroke = Instance.new("UIStroke")
            multiStroke.Thickness = 1
            multiStroke.Color = Colors.Border
            multiStroke.Parent = multiFrame
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -60, 1, 0)
            label.Position = UDim2.new(0, 14, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Colors.Text
            label.TextSize = 14
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = multiFrame.ZIndex + 1
            label.Parent = multiFrame
            
            -- Multi icon
            if multiIcon then
                local iconImage = Instance.new("ImageLabel")
                iconImage.Size = UDim2.new(0, 20, 0, 20)
                iconImage.Position = UDim2.new(0, 14, 0.5, -10)
                iconImage.BackgroundTransparency = 1
                iconImage.Image = multiIcon
                iconImage.ImageColor3 = Colors.Text
                iconImage.ZIndex = multiFrame.ZIndex + 1
                iconImage.Parent = multiFrame
                
                label.Position = UDim2.new(0, 44, 0, 0)
                label.Size = UDim2.new(1, -90, 1, 0)
            end
            
            local arrowBtn = Instance.new("TextButton")
            arrowBtn.Size = UDim2.new(0, 36, 0, 36)
            arrowBtn.Position = UDim2.new(1, -42, 0.5, -18)
            arrowBtn.BackgroundColor3 = Colors.Button
            arrowBtn.AutoButtonColor = false
            arrowBtn.Text = "▼"
            arrowBtn.TextColor3 = Colors.Text
            arrowBtn.Font = Enum.Font.GothamBold
            arrowBtn.TextSize = 14
            arrowBtn.ZIndex = multiFrame.ZIndex + 1
            arrowBtn.Parent = multiFrame
            
            local arrowCorner = Instance.new("UICorner")
            arrowCorner.CornerRadius = UDim.new(0, 8)
            arrowCorner.Parent = arrowBtn
            
            -- Create options frame
            local optionsFrame = Instance.new("Frame")
            optionsFrame.Size = UDim2.new(0, 0, 0, 0)
            optionsFrame.BackgroundColor3 = Colors.Dropdown
            optionsFrame.ClipsDescendants = true
            optionsFrame.Visible = false
            optionsFrame.ZIndex = ScreenGuiManager.DropdownZIndex
            optionsFrame.Parent = self.ScreenGui
            
            local optionsCorner = Instance.new("UICorner")
            optionsCorner.CornerRadius = UDim.new(0, 8)
            optionsCorner.Parent = optionsFrame
            
            local optionsStroke = Instance.new("UIStroke")
            optionsStroke.Thickness = 1
            optionsStroke.Color = Colors.Border
            optionsStroke.Parent = optionsFrame
            
            local optionsScrolling = Instance.new("ScrollingFrame")
            optionsScrolling.Size = UDim2.new(1, 0, 1, 0)
            optionsScrolling.BackgroundTransparency = 1
            optionsScrolling.BorderSizePixel = 0
            optionsScrolling.ScrollBarThickness = 6
            optionsScrolling.ScrollBarImageColor3 = Colors.Primary
            optionsScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
            optionsScrolling.ZIndex = optionsFrame.ZIndex + 1
            optionsScrolling.Parent = optionsFrame
            
            local optionsLayout = Instance.new("UIListLayout")
            optionsLayout.Padding = UDim.new(0, 4)
            optionsLayout.Parent = optionsScrolling
            
            local optionsPadding = Instance.new("UIPadding")
            optionsPadding.PaddingTop = UDim.new(0, 4)
            optionsPadding.PaddingBottom = UDim.new(0, 4)
            optionsPadding.PaddingLeft = UDim.new(0, 4)
            optionsPadding.PaddingRight = UDim.new(0, 4)
            optionsPadding.Parent = optionsScrolling
            
            local open = false
            local selectedOptions = {}
            local optionToggles = {}
            
            local function updateMultiPosition()
                local multiAbsPos = multiFrame.AbsolutePosition
                local multiAbsSize = multiFrame.AbsoluteSize
                local screenSize = workspace.CurrentCamera.ViewportSize
                
                local spaceBelow = screenSize.Y - (multiAbsPos.Y + multiAbsSize.Y + 4)
                local spaceAbove = multiAbsPos.Y - 4
                local totalHeight = math.min(optionsLayout.AbsoluteContentSize.Y + 8, 200)
                
                local positionY
                if spaceBelow >= totalHeight or spaceBelow >= spaceAbove then
                    positionY = multiAbsPos.Y + multiAbsSize.Y + 4
                else
                    positionY = multiAbsPos.Y - totalHeight - 4
                end
                
                optionsFrame.Position = UDim2.new(0, multiAbsPos.X, 0, positionY)
                optionsFrame.Size = UDim2.new(0, multiAbsSize.X, 0, 0)
            end
            
            local function updateLabel()
                local count = 0
                for _ in pairs(selectedOptions) do
                    count = count + 1
                end
                
                if count == 0 then
                    label.Text = text
                else
                    label.Text = text .. ": " .. count .. " selected"
                end
            end
            
            local function createMultiOption(optionText, optionIcon)
                local optionFrame = Instance.new("Frame")
                optionFrame.Size = UDim2.new(1, -8, 0, 32)
                optionFrame.BackgroundColor3 = Colors.Button
                optionFrame.ZIndex = optionsScrolling.ZIndex + 1
                optionFrame.Parent = optionsScrolling
                
                local optionCorner = Instance.new("UICorner")
                optionCorner.CornerRadius = UDim.new(0, 6)
                optionCorner.Parent = optionFrame
                
                local content = Instance.new("Frame")
                content.Size = UDim2.new(1, -40, 1, -6)
                content.Position = UDim2.new(0, 34, 0, 3)
                content.BackgroundTransparency = 1
                content.ZIndex = optionFrame.ZIndex + 1
                content.Parent = optionFrame
                
                local layout = Instance.new("UIListLayout")
                layout.FillDirection = Enum.FillDirection.Horizontal
                layout.HorizontalAlignment = Enum.HorizontalAlignment.Left
                layout.VerticalAlignment = Enum.VerticalAlignment.Center
                layout.Padding = UDim.new(0, 6)
                layout.Parent = content
                
                -- Option icon
                if optionIcon then
                    local iconImg = Instance.new("ImageLabel")
                    iconImg.Size = UDim2.new(0, 18, 0, 18)
                    iconImg.BackgroundTransparency = 1
                    iconImg.Image = optionIcon
                    iconImg.ImageColor3 = Colors.Text
                    iconImg.ZIndex = content.ZIndex + 1
                    iconImg.Parent = content
                end
                
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(0, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.Text = optionText
                textLabel.TextColor3 = Colors.Text
                textLabel.Font = Enum.Font.GothamSemibold
                textLabel.TextSize = 13
                textLabel.TextXAlignment = Enum.TextXAlignment.Left
                textLabel.AutomaticSize = Enum.AutomaticSize.X
                textLabel.ZIndex = content.ZIndex + 1
                textLabel.Parent = content
                
                local toggle = Instance.new("Frame")
                toggle.Size = UDim2.new(0, 20, 0, 20)
                toggle.Position = UDim2.new(0, 8, 0.5, -10)
                toggle.BackgroundColor3 = Colors.Button
                toggle.ZIndex = optionFrame.ZIndex + 1
                toggle.Parent = optionFrame
                
                local toggleCorner = Instance.new("UICorner")
                toggleCorner.CornerRadius = UDim.new(0, 4)
                toggleCorner.Parent = toggle
                
                local check = Instance.new("Frame")
                check.Size = UDim2.new(0, 12, 0, 12)
                check.Position = UDim2.new(0.5, -6, 0.5, -6)
                check.BackgroundColor3 = Colors.Checkbox
                check.Visible = false
                check.ZIndex = toggle.ZIndex + 1
                check.Parent = toggle
                
                local checkCorner = Instance.new("UICorner")
                checkCorner.CornerRadius = UDim.new(0, 2)
                checkCorner.Parent = check
                
                local clickBtn = Instance.new("TextButton")
                clickBtn.Size = UDim2.new(1, 0, 1, 0)
                clickBtn.BackgroundTransparency = 1
                clickBtn.Text = ""
                clickBtn.ZIndex = optionFrame.ZIndex + 2
                clickBtn.Parent = optionFrame
                
                local isSelected = false
                
                local function updateToggle()
                    check.Visible = isSelected
                    if isSelected then
                        selectedOptions[optionText] = true
                    else
                        selectedOptions[optionText] = nil
                    end
                    updateLabel()
                    if callback then
                        local selectedList = {}
                        for opt in pairs(selectedOptions) do
                            table.insert(selectedList, opt)
                        end
                        callback(selectedList)
                    end
                end
                
                clickBtn.MouseButton1Click:Connect(function()
                    isSelected = not isSelected
                    updateToggle()
                end)
                
                optionFrame.MouseEnter:Connect(function()
                    Tween(optionFrame, {BackgroundColor3 = Color3.fromRGB(45, 45, 50)})
                end)
                
                optionFrame.MouseLeave:Connect(function()
                    Tween(optionFrame, {BackgroundColor3 = Colors.Button})
                end)
                
                table.insert(optionToggles, {
                    Frame = optionFrame,
                    Text = optionText,
                    Set = function(state)
                        isSelected = state
                        updateToggle()
                    end,
                    Get = function()
                        return isSelected
                    end
                })
                
                return optionFrame
            end
            
            -- Create options
            for _, opt in ipairs(options) do
                local optionText, optionIcon
                if type(opt) == "table" then
                    optionText = opt.Text or "Option"
                    optionIcon = opt.Icon
                else
                    optionText = tostring(opt)
                    optionIcon = nil
                end
                createMultiOption(optionText, optionIcon)
            end
            
            local function openMultiDropdown()
                if open then return end
                open = true
                
                updateMultiPosition()
                optionsFrame.Visible = true
                Tween(arrowBtn, {Rotation = 180})
                
                local totalHeight = math.min(optionsLayout.AbsoluteContentSize.Y + 8, 200)
                Tween(optionsFrame, {Size = UDim2.new(0, multiFrame.AbsoluteSize.X, 0, totalHeight)})
            end
            
            local function closeMultiDropdown()
                if not open then return end
                open = false
                
                Tween(optionsFrame, {Size = UDim2.new(0, multiFrame.AbsoluteSize.X, 0, 0)})
                Tween(arrowBtn, {Rotation = 0})
                
                wait(0.2)
                optionsFrame.Visible = false
            end
            
            arrowBtn.MouseButton1Click:Connect(function()
                if open then
                    closeMultiDropdown()
                else
                    openMultiDropdown()
                end
            end)
            
            -- Close when clicking outside
            local multiConnection
            multiConnection = UserInputService.InputBegan:Connect(function(input)
                if open and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
                    local mousePos = input.Position
                    local multiAbsPos = multiFrame.AbsolutePosition
                    local multiAbsSize = multiFrame.AbsoluteSize
                    local optionsAbsPos = optionsFrame.AbsolutePosition
                    local optionsAbsSize = optionsFrame.AbsoluteSize
                    
                    local isInMulti = mousePos.X >= multiAbsPos.X and mousePos.X <= multiAbsPos.X + multiAbsSize.X and
                                     mousePos.Y >= multiAbsPos.Y and mousePos.Y <= multiAbsPos.Y + multiAbsSize.Y
                    
                    local isInOptions = mousePos.X >= optionsAbsPos.X and mousePos.X <= optionsAbsPos.X + optionsAbsSize.X and
                                       mousePos.Y >= optionsAbsPos.Y and mousePos.Y <= optionsAbsPos.Y + optionsAbsSize.Y
                    
                    if not isInMulti and not isInOptions then
                        closeMultiDropdown()
                    end
                end
            end)
            
            -- Clean up
            multiFrame.Destroying:Connect(function()
                if multiConnection then
                    multiConnection:Disconnect()
                end
                if optionsFrame then
                    optionsFrame:Destroy()
                end
            end)
            
            local multiObj = {}
            
            function multiObj:Set(selected)
                if type(selected) == "table" then
                    for _, toggle in ipairs(optionToggles) do
                        local shouldBeSelected = false
                        for _, sel in ipairs(selected) do
                            if toggle.Text == sel then
                                shouldBeSelected = true
                                break
                            end
                        end
                        toggle.Set(shouldBeSelected)
                    end
                else
                    for _, toggle in ipairs(optionToggles) do
                        if toggle.Text == selected then
                            toggle.Set(not toggle.Get())
                            break
                        end
                    end
                end
            end
            
            function multiObj:Get()
                local result = {}
                for _, toggle in ipairs(optionToggles) do
                    if toggle.Get() then
                        table.insert(result, toggle.Text)
                    end
                end
                return result
            end
            
            function multiObj:Clear()
                for _, toggle in ipairs(optionToggles) do
                    toggle.Set(false)
                end
            end
            
            return multiObj
        end
        
        -- Textbox component
        function tabData:AddTextbox(text, placeholder, callback, textboxIcon)
            local textboxFrame = Instance.new("Frame")
            textboxFrame.Size = UDim2.new(1, 0, 0, 38)
            textboxFrame.BackgroundColor3 = Colors.Foreground
            textboxFrame.ZIndex = contentFrame.ZIndex + 1
            textboxFrame.Parent = contentFrame
            
            local textboxCorner = Instance.new("UICorner")
            textboxCorner.CornerRadius = UDim.new(0, 8)
            textboxCorner.Parent = textboxFrame
            
            local textboxStroke = Instance.new("UIStroke")
            textboxStroke.Thickness = 1
            textboxStroke.Color = Colors.Border
            textboxStroke.Parent = textboxFrame
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0, 100, 1, 0)
            label.Position = UDim2.new(0, 14, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Colors.Text
            label.TextSize = 14
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = textboxFrame.ZIndex + 1
            label.Parent = textboxFrame
            
            -- Textbox icon
            if textboxIcon then
                local iconImage = Instance.new("ImageLabel")
                iconImage.Size = UDim2.new(0, 20, 0, 20)
                iconImage.Position = UDim2.new(0, 14, 0.5, -10)
                iconImage.BackgroundTransparency = 1
                iconImage.Image = textboxIcon
                iconImage.ImageColor3 = Colors.Text
                iconImage.ZIndex = textboxFrame.ZIndex + 1
                iconImage.Parent = textboxFrame
                
                label.Position = UDim2.new(0, 44, 0, 0)
                label.Size = UDim2.new(0, 80, 1, 0)
            end
            
            local textbox = Instance.new("TextBox")
            textbox.Size = UDim2.new(1, -120, 1, -12)
            textbox.Position = UDim2.new(0, 108, 0, 6)
            textbox.BackgroundColor3 = Colors.Button
            textbox.TextColor3 = Colors.Text
            textbox.PlaceholderColor3 = Colors.SubText
            textbox.PlaceholderText = placeholder or "Enter text..."
            textbox.Text = ""
            textbox.TextSize = 14
            textbox.Font = Enum.Font.Gotham
            textbox.ClearTextOnFocus = false
            textbox.ZIndex = textboxFrame.ZIndex + 1
            textbox.Parent = textboxFrame
            
            local textboxCorner2 = Instance.new("UICorner")
            textboxCorner2.CornerRadius = UDim.new(0, 6)
            textboxCorner2.Parent = textbox
            
            local textboxStroke2 = Instance.new("UIStroke")
            textboxStroke2.Thickness = 1
            textboxStroke2.Color = Colors.Border
            textboxStroke2.Parent = textbox
            
            textbox.Focused:Connect(function()
                Tween(textbox, {BackgroundColor3 = Color3.fromRGB(40, 40, 45)})
                Tween(textboxStroke2, {Color = Colors.Primary})
            end)
            
            textbox.FocusLost:Connect(function(enterPressed)
                Tween(textbox, {BackgroundColor3 = Colors.Button})
                Tween(textboxStroke2, {Color = Colors.Border})
                if callback then
                    callback(textbox.Text)
                end
            end)
            
            local textboxObj = {}
            
            function textboxObj:Set(value)
                textbox.Text = tostring(value)
            end
            
            function textboxObj:Get()
                return textbox.Text
            end
            
            return textboxObj
        end
        
        -- Label component
        function tabData:AddLabel(text, labelIcon)
            local labelFrame = Instance.new("Frame")
            labelFrame.Size = UDim2.new(1, 0, 0, 32)
            labelFrame.BackgroundTransparency = 1
            labelFrame.ZIndex = contentFrame.ZIndex + 1
            labelFrame.Parent = contentFrame
            
            local labelLayout = Instance.new("UIListLayout")
            labelLayout.FillDirection = Enum.FillDirection.Horizontal
            labelLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
            labelLayout.VerticalAlignment = Enum.VerticalAlignment.Center
            labelLayout.Padding = UDim.new(0, 8)
            labelLayout.Parent = labelFrame
            
            -- Label icon
            if labelIcon then
                local iconImage = Instance.new("ImageLabel")
                iconImage.Size = UDim2.new(0, 20, 0, 20)
                iconImage.BackgroundTransparency = 1
                iconImage.Image = labelIcon
                iconImage.ImageColor3 = Colors.Text
                iconImage.ZIndex = labelFrame.ZIndex + 1
                iconImage.Parent = labelFrame
            end
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0, 0, 1, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Colors.Text
            label.TextSize = 14
            label.Font = Enum.Font.GothamBold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.AutomaticSize = Enum.AutomaticSize.X
            label.ZIndex = labelFrame.ZIndex + 1
            label.Parent = labelFrame
            
            return label
        end
        
        -- Slider component
        function tabData:AddSlider(text, min, max, default, callback, sliderIcon)
            local sliderFrame = Instance.new("Frame")
            sliderFrame.Size = UDim2.new(1, 0, 0, 38)
            sliderFrame.BackgroundColor3 = Colors.Foreground
            sliderFrame.ZIndex = contentFrame.ZIndex + 1
            sliderFrame.Parent = contentFrame
            
            local sliderCorner = Instance.new("UICorner")
            sliderCorner.CornerRadius = UDim.new(0, 8)
            sliderCorner.Parent = sliderFrame
            
            local sliderStroke = Instance.new("UIStroke")
            sliderStroke.Thickness = 1
            sliderStroke.Color = Colors.Border
            sliderStroke.Parent = sliderFrame
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -70, 1, 0)
            label.Position = UDim2.new(0, 14, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Colors.Text
            label.TextSize = 14
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = sliderFrame.ZIndex + 1
            label.Parent = sliderFrame
            
            -- Slider icon
            if sliderIcon then
                local iconImage = Instance.new("ImageLabel")
                iconImage.Size = UDim2.new(0, 20, 0, 20)
                iconImage.Position = UDim2.new(0, 14, 0.5, -10)
                iconImage.BackgroundTransparency = 1
                iconImage.Image = sliderIcon
                iconImage.ImageColor3 = Colors.Text
                iconImage.ZIndex = sliderFrame.ZIndex + 1
                iconImage.Parent = sliderFrame
                
                label.Position = UDim2.new(0, 44, 0, 0)
                label.Size = UDim2.new(1, -100, 1, 0)
            end
            
            local valueLabel = Instance.new("TextLabel")
            valueLabel.Size = UDim2.new(0, 60, 0, 38)
            valueLabel.Position = UDim2.new(1, -74, 0, 0)
            valueLabel.BackgroundTransparency = 1
            valueLabel.Text = tostring(default or min)
            valueLabel.TextColor3 = Colors.Primary
            valueLabel.TextSize = 14
            valueLabel.Font = Enum.Font.GothamBold
            valueLabel.TextXAlignment = Enum.TextXAlignment.Right
            valueLabel.ZIndex = sliderFrame.ZIndex + 1
            valueLabel.Parent = sliderFrame
            
            local sliderBar = Instance.new("Frame")
            sliderBar.Size = UDim2.new(1, -90, 0, 4)
            sliderBar.Position = UDim2.new(0, 14, 0, 28)
            sliderBar.BackgroundColor3 = Colors.Button
            sliderBar.ZIndex = sliderFrame.ZIndex + 1
            sliderBar.Parent = sliderFrame
            
            local barCorner = Instance.new("UICorner")
            barCorner.CornerRadius = UDim.new(1, 0)
            barCorner.Parent = sliderBar
            
            local sliderFill = Instance.new("Frame")
            sliderFill.Size = UDim2.new(0, 0, 1, 0)
            sliderFill.BackgroundColor3 = Colors.Primary
            sliderFill.ZIndex = sliderBar.ZIndex + 1
            sliderFill.Parent = sliderBar
            
            local fillCorner = Instance.new("UICorner")
            fillCorner.CornerRadius = UDim.new(1, 0)
            fillCorner.Parent = sliderFill
            
            local sliderButton = Instance.new("TextButton")
            sliderButton.Size = UDim2.new(0, 12, 0, 12)
            sliderButton.Position = UDim2.new(0, 0, 0.5, -6)
            sliderButton.BackgroundColor3 = Colors.Text
            sliderButton.AutoButtonColor = false
            sliderButton.Text = ""
            sliderButton.ZIndex = sliderBar.ZIndex + 2
            sliderButton.Parent = sliderBar
            
            local buttonCorner = Instance.new("UICorner")
            buttonCorner.CornerRadius = UDim.new(1, 0)
            buttonCorner.Parent = sliderButton
            
            local currentValue = math.clamp(default or min, min, max)
            local dragging = false
            
            local function updateValue(value)
                currentValue = math.clamp(value, min, max)
                local percentage = (currentValue - min) / (max - min)
                
                valueLabel.Text = string.format("%.2f", currentValue)
                sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
                sliderButton.Position = UDim2.new(percentage, -6, 0.5, -6)
                
                if callback then
                    callback(currentValue)
                end
            end
            
            local function onInputBegan(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    
                    local mousePos = input.Position.X
                    local sliderAbsPos = sliderBar.AbsolutePosition.X
                    local sliderAbsSize = sliderBar.AbsoluteSize.X
                    
                    local percentage = math.clamp((mousePos - sliderAbsPos) / sliderAbsSize, 0, 1)
                    local value = min + (percentage * (max - min))
                    
                    updateValue(value)
                end
            end
            
            local function onInputChanged(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local mousePos = input.Position.X
                    local sliderAbsPos = sliderBar.AbsolutePosition.X
                    local sliderAbsSize = sliderBar.AbsoluteSize.X
                    
                    local percentage = math.clamp((mousePos - sliderAbsPos) / sliderAbsSize, 0, 1)
                    local value = min + (percentage * (max - min))
                    
                    updateValue(value)
                end
            end
            
            local function onInputEnded(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end
            
            sliderButton.InputBegan:Connect(onInputBegan)
            sliderBar.InputBegan:Connect(onInputBegan)
            
            UserInputService.InputChanged:Connect(onInputChanged)
            UserInputService.InputEnded:Connect(onInputEnded)
            
            updateValue(currentValue)
            
            local sliderObj = {}
            
            function sliderObj:Set(value)
                updateValue(value)
            end
            
            function sliderObj:Get()
                return currentValue
            end
            
            return sliderObj
        end
        
        -- Notification function for tab
        function tabData:Notify(title, content, notificationType, duration)
            return self.Notifications:CreateNotification(title, content, notificationType, duration)
        end
        
        self.Tabs[name] = tabData
        return tabData
    end
    
    -- Global notification function
    function self:Notify(title, content, notificationType, duration)
        return self.Notifications:CreateNotification(title, content, notificationType, duration)
    end
    
    -- Auto-select first tab
    task.spawn(function()
        wait(0.1)
        for _, child in pairs(self.TabsContainer:GetChildren()) do
            if child:IsA("TextButton") then
                child:MouseButton1Click()
                break
            end
        end
    end)
    
    return self
end

return UILibrary
