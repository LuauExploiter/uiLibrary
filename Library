-- COMPLETELY FIXED UI LIBRARY - NO CAMERA MOVEMENT, ALL ELEMENTS SHOW
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local UILibrary = {}
UILibrary.__index = UILibrary

-- Colors
local Colors = {
    Background = Color3.fromRGB(15, 15, 20),
    Foreground = Color3.fromRGB(25, 25, 35),
    Primary = Color3.fromRGB(0, 120, 255),
    Text = Color3.fromRGB(240, 240, 245),
    SubText = Color3.fromRGB(160, 160, 170),
    Close = Color3.fromRGB(255, 60, 60),
    Minimize = Color3.fromRGB(255, 180, 40),
    Border = Color3.fromRGB(40, 40, 50)
}

-- Tween helper
local function Tween(obj, props, time)
    time = time or 0.2
    local tween = TweenService:Create(obj, TweenInfo.new(time, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props)
    tween:Play()
    return tween
end

-- Create Window
function UILibrary:Create(title)
    local self = setmetatable({}, UILibrary)
    
    -- ScreenGui
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "UILibrary_" .. math.random(1000, 9999)
    self.ScreenGui.ResetOnSpawn = false
    
    if game.CoreGui then
        self.ScreenGui.Parent = game.CoreGui
    else
        self.ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    end
    
    -- Main Window - 420x250
    self.Window = Instance.new("Frame")
    self.Window.Name = "Window"
    self.Window.Size = UDim2.new(0, 420, 0, 250)
    self.Window.Position = UDim2.new(0.5, -210, 0.5, -125)
    self.Window.BackgroundColor3 = Colors.Background
    self.Window.BorderSizePixel = 0
    self.Window.ClipsDescendants = true
    self.Window.Parent = self.ScreenGui
    
    -- FIX: FULL ROUNDED CORNERS
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12) -- Larger radius for better appearance
    corner.Parent = self.Window
    
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Colors.Primary
    stroke.Parent = self.Window
    
    -- Top Bar for dragging
    self.TopBar = Instance.new("Frame")
    self.TopBar.Name = "TopBar"
    self.TopBar.Size = UDim2.new(1, 0, 0, 35)
    self.TopBar.BackgroundColor3 = Colors.Foreground
    self.TopBar.BorderSizePixel = 0
    self.TopBar.Parent = self.Window
    
    -- FIX: Top corners rounded, bottom corners square
    local topCorner = Instance.new("UICorner")
    topCorner.CornerRadius = UDim.new(0, 12, 0, 0)
    topCorner.Parent = self.TopBar
    
    -- FIX: COMPLETE DRAGGING FIX - NO CAMERA MOVEMENT
    local dragging = false
    local dragStart, windowStart
    
    local function startDrag(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            windowStart = self.Window.Position
            
            -- Highlight
            Tween(self.TopBar, {BackgroundColor3 = Colors.Foreground:lerp(Colors.Primary, 0.3)}, 0.15)
            
            -- FIX: Prevent camera movement by capturing input
            game:GetService("ContextActionService"):BindAction(
                "PreventCameraDrag",
                function() return Enum.ContextActionResult.Sink end,
                false,
                Enum.UserInputType.MouseMovement,
                Enum.UserInputType.MouseButton1
            )
        end
    end
    
    local function updateDrag(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            self.Window.Position = UDim2.new(
                windowStart.X.Scale,
                windowStart.X.Offset + delta.X,
                windowStart.Y.Scale,
                windowStart.Y.Offset + delta.Y
            )
        end
    end
    
    local function endDrag()
        if dragging then
            dragging = false
            Tween(self.TopBar, {BackgroundColor3 = Colors.Foreground}, 0.15)
            
            -- FIX: Release input capture
            game:GetService("ContextActionService"):UnbindAction("PreventCameraDrag")
        end
    end
    
    -- Connect dragging events
    self.TopBar.InputBegan:Connect(startDrag)
    self.TopBar.InputChanged:Connect(updateDrag)
    self.TopBar.InputEnded:Connect(endDrag)
    
    -- Title
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(0, 180, 1, 0)
    titleLabel.Position = UDim2.new(0, 15, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "UI Library"
    titleLabel.TextColor3 = Colors.Text
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.GothamSemibold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = self.TopBar
    
    -- Make title also draggable
    titleLabel.InputBegan:Connect(startDrag)
    titleLabel.InputChanged:Connect(updateDrag)
    titleLabel.InputEnded:Connect(endDrag)
    
    -- Close Button
    self.CloseBtn = Instance.new("TextButton")
    self.CloseBtn.Name = "Close"
    self.CloseBtn.Size = UDim2.new(0, 25, 0, 25)
    self.CloseBtn.Position = UDim2.new(1, -35, 0.5, -12.5)
    self.CloseBtn.BackgroundColor3 = Colors.Close
    self.CloseBtn.TextColor3 = Colors.Text
    self.CloseBtn.TextSize = 18
    self.CloseBtn.Text = "×"
    self.CloseBtn.Font = Enum.Font.GothamBold
    self.CloseBtn.Parent = self.TopBar
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 6)
    closeCorner.Parent = self.CloseBtn
    
    -- Minimize Button
    self.MinimizeBtn = Instance.new("TextButton")
    self.MinimizeBtn.Name = "Minimize"
    self.MinimizeBtn.Size = UDim2.new(0, 25, 0, 25)
    self.MinimizeBtn.Position = UDim2.new(1, -65, 0.5, -12.5)
    self.MinimizeBtn.BackgroundColor3 = Colors.Minimize
    self.MinimizeBtn.TextColor3 = Colors.Text
    self.MinimizeBtn.TextSize = 18
    self.MinimizeBtn.Text = "-"
    self.MinimizeBtn.Font = Enum.Font.GothamBold
    self.MinimizeBtn.Parent = self.TopBar
    
    local minCorner = Instance.new("UICorner")
    minCorner.CornerRadius = UDim.new(0, 6)
    minCorner.Parent = self.MinimizeBtn
    
    -- Left Panel for Tabs - 110px wide
    self.LeftPanel = Instance.new("Frame")
    self.LeftPanel.Name = "LeftPanel"
    self.LeftPanel.Size = UDim2.new(0, 110, 1, -35) -- FIXED: Subtract top bar height
    self.LeftPanel.Position = UDim2.new(0, 0, 0, 35)
    self.LeftPanel.BackgroundColor3 = Colors.Foreground
    self.LeftPanel.Parent = self.Window
    
    -- FIX: Bottom-left corners rounded
    local leftCorner = Instance.new("UICorner")
    leftCorner.CornerRadius = UDim.new(0, 0, 0, 12)
    leftCorner.Parent = self.LeftPanel
    
    -- Scrollable tab container
    self.TabsContainer = Instance.new("ScrollingFrame")
    self.TabsContainer.Name = "TabsContainer"
    self.TabsContainer.Size = UDim2.new(1, 0, 1, 0)
    self.TabsContainer.Position = UDim2.new(0, 0, 0, 0)
    self.TabsContainer.BackgroundTransparency = 1
    self.TabsContainer.BorderSizePixel = 0
    self.TabsContainer.ScrollBarThickness = 3
    self.TabsContainer.ScrollBarImageColor3 = Colors.SubText
    self.TabsContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.TabsContainer.ScrollingDirection = Enum.ScrollingDirection.Y
    self.TabsContainer.Parent = self.LeftPanel
    
    local tabsList = Instance.new("UIListLayout")
    tabsList.Padding = UDim.new(0, 8)
    tabsList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabsList.Parent = self.TabsContainer
    
    local tabsPadding = Instance.new("UIPadding")
    tabsPadding.PaddingTop = UDim.new(0, 10)
    tabsPadding.PaddingBottom = UDim.new(0, 10)
    tabsPadding.Parent = self.TabsContainer
    
    -- Content Panel (Right Side) - FIXED: Proper calculation
    self.ContentPanel = Instance.new("Frame")
    self.ContentPanel.Name = "ContentPanel"
    self.ContentPanel.Size = UDim2.new(1, -110, 1, -35) -- Takes remaining width minus left panel
    self.ContentPanel.Position = UDim2.new(0, 110, 0, 35) -- Starts after left panel
    self.ContentPanel.BackgroundColor3 = Colors.Background
    self.ContentPanel.Parent = self.Window
    
    -- FIX: Bottom-right corners rounded
    local rightCorner = Instance.new("UICorner")
    rightCorner.CornerRadius = UDim.new(0, 0, 0, 12)
    rightCorner.Parent = self.ContentPanel
    
    -- Main Content Frame - THIS IS WHERE ELEMENTS GO
    self.Content = Instance.new("ScrollingFrame")
    self.Content.Name = "Content"
    self.Content.Size = UDim2.new(1, 0, 1, 0)
    self.Content.Position = UDim2.new(0, 0, 0, 0)
    self.Content.BackgroundTransparency = 1
    self.Content.BorderSizePixel = 0
    self.Content.ScrollBarThickness = 3
    self.Content.ScrollBarImageColor3 = Colors.SubText
    self.Content.AutomaticCanvasSize = Enum.AutomaticSize.Y
    self.Content.ScrollingDirection = Enum.ScrollingDirection.Y
    self.Content.Parent = self.ContentPanel
    
    local contentList = Instance.new("UIListLayout")
    contentList.Padding = UDim.new(0, 10)
    contentList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    contentList.SortOrder = Enum.SortOrder.LayoutOrder
    contentList.Parent = self.Content
    
    local contentPadding = Instance.new("UIPadding")
    contentPadding.PaddingTop = UDim.new(0, 10)
    contentPadding.PaddingLeft = UDim.new(0, 10)
    contentPadding.PaddingRight = UDim.new(0, 10)
    contentPadding.Parent = self.Content
    
    -- FIX: Update canvas size
    contentList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.Content.CanvasSize = UDim2.new(0, 0, 0, contentList.AbsoluteContentSize.Y + 20)
    end)
    
    -- Minimize functionality
    local minimized = false
    local originalSize = self.Window.Size
    
    self.MinimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        if minimized then
            Tween(self.Window, {Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset, 0, 35)}, 0.2)
            self.MinimizeBtn.Text = "+"
        else
            Tween(self.Window, {Size = originalSize}, 0.2)
            self.MinimizeBtn.Text = "-"
        end
    end)
    
    -- Close functionality
    self.CloseBtn.MouseButton1Click:Connect(function()
        Tween(self.Window, {Size = UDim2.new(0, 0, 0, 0)}, 0.2)
        task.wait(0.2)
        self.ScreenGui:Destroy()
    end)
    
    -- Button hover effects
    self.CloseBtn.MouseEnter:Connect(function()
        Tween(self.CloseBtn, {BackgroundColor3 = Colors.Close:lerp(Color3.new(1,1,1), 0.3)}, 0.2)
    end)
    
    self.CloseBtn.MouseLeave:Connect(function()
        Tween(self.CloseBtn, {BackgroundColor3 = Colors.Close}, 0.2)
    end)
    
    self.MinimizeBtn.MouseEnter:Connect(function()
        Tween(self.MinimizeBtn, {BackgroundColor3 = Colors.Minimize:lerp(Color3.new(1,1,1), 0.3)}, 0.2)
    end)
    
    self.MinimizeBtn.MouseLeave:Connect(function()
        Tween(self.MinimizeBtn, {BackgroundColor3 = Colors.Minimize}, 0.2)
    end)
    
    -- Store tabs
    self.Tabs = {}
    self.CurrentTab = nil
    
    return self
end

-- Create Tab
function UILibrary:Tab(name)
    -- Tab button
    local tabBtn = Instance.new("TextButton")
    tabBtn.Name = name .. "Tab"
    tabBtn.Size = UDim2.new(0.9, 0, 0, 35)
    tabBtn.BackgroundColor3 = Colors.Foreground
    tabBtn.Text = name
    tabBtn.TextColor3 = Colors.SubText
    tabBtn.TextSize = 13
    tabBtn.Font = Enum.Font.Gotham
    tabBtn.Parent = self.TabsContainer
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 8)
    tabCorner.Parent = tabBtn
    
    -- Tab content frame
    local tabContent = Instance.new("Frame")
    tabContent.Name = name .. "Content"
    tabContent.Size = UDim2.new(1, 0, 0, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.Visible = false
    tabContent.LayoutOrder = 1
    tabContent.Parent = self.Content
    
    -- FIX: Use AutomaticSize for content
    tabContent.AutomaticSize = Enum.AutomaticSize.Y
    
    local contentList = Instance.new("UIListLayout")
    contentList.Padding = UDim.new(0, 10)
    contentList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    contentList.SortOrder = Enum.SortOrder.LayoutOrder
    contentList.Parent = tabContent
    
    local tab = {
        Button = tabBtn,
        Content = tabContent,
        Name = name
    }
    
    -- Set as active if first tab
    if not self.CurrentTab then
        self.CurrentTab = tab
        tabBtn.BackgroundColor3 = Colors.Primary
        tabBtn.TextColor3 = Colors.Text
        tabContent.Visible = true
    end
    
    -- Tab switching
    tabBtn.MouseButton1Click:Connect(function()
        if self.CurrentTab == tab then return end
        
        if self.CurrentTab then
            self.CurrentTab.Content.Visible = false
            Tween(self.CurrentTab.Button, {
                BackgroundColor3 = Colors.Foreground,
                TextColor3 = Colors.SubText
            }, 0.15)
        end
        
        self.CurrentTab = tab
        tabContent.Visible = true
        
        Tween(tabBtn, {
            BackgroundColor3 = Colors.Primary,
            TextColor3 = Colors.Text
        }, 0.15)
    end)
    
    -- Tab hover effect
    tabBtn.MouseEnter:Connect(function()
        if self.CurrentTab ~= tab then
            Tween(tabBtn, {BackgroundColor3 = Colors.Foreground:lerp(Colors.Primary, 0.3)}, 0.15)
        end
    end)
    
    tabBtn.MouseLeave:Connect(function()
        if self.CurrentTab ~= tab then
            Tween(tabBtn, {BackgroundColor3 = Colors.Foreground}, 0.15)
        end
    end)
    
    table.insert(self.Tabs, tab)
    
    -- Element methods
    local methods = {}
    
    -- BUTTON (GUARANTEED TO SHOW)
    function methods:Button(text, callback)
        local btn = Instance.new("TextButton")
        btn.Name = "Button_" .. text
        btn.Size = UDim2.new(1, -20, 0, 40)
        btn.BackgroundColor3 = Colors.Foreground
        btn.Text = text
        btn.TextColor3 = Colors.Text
        btn.TextSize = 14
        btn.Font = Enum.Font.GothamSemibold
        btn.LayoutOrder = #self.CurrentTab.Content:GetChildren() + 1
        btn.Parent = self.CurrentTab.Content
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 8)
        btnCorner.Parent = btn
        
        -- Hover effect
        btn.MouseEnter:Connect(function()
            Tween(btn, {
                BackgroundColor3 = Colors.Primary,
                Size = UDim2.new(1, -15, 0, 40)
            }, 0.15)
        end)
        
        btn.MouseLeave:Connect(function()
            Tween(btn, {
                BackgroundColor3 = Colors.Foreground,
                Size = UDim2.new(1, -20, 0, 40)
            }, 0.15)
        end)
        
        -- Click
        btn.MouseButton1Click:Connect(function()
            if callback then 
                callback() 
            end
        end)
        
        return btn
    end
    
    -- TOGGLE (GUARANTEED TO SHOW)
    function methods:Toggle(text, default, callback)
        local frame = Instance.new("Frame")
        frame.Name = "Toggle_" .. text
        frame.Size = UDim2.new(1, -20, 0, 40)
        frame.BackgroundColor3 = Colors.Foreground
        frame.LayoutOrder = #self.CurrentTab.Content:GetChildren() + 1
        frame.Parent = self.CurrentTab.Content
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = frame
        
        -- Label
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.7, 0, 1, 0)
        label.Position = UDim2.new(0, 15, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = frame
        
        -- Toggle switch
        local toggle = Instance.new("Frame")
        toggle.Size = UDim2.new(0, 50, 0, 25)
        toggle.Position = UDim2.new(1, -60, 0.5, -12.5)
        toggle.BackgroundColor3 = Colors.Border
        toggle.Parent = frame
        
        local toggleCorner = Instance.new("UICorner")
        toggleCorner.CornerRadius = UDim.new(0, 12)
        toggleCorner.Parent = toggle
        
        -- Dot
        local dot = Instance.new("Frame")
        dot.Size = UDim2.new(0, 21, 0, 21)
        dot.Position = UDim2.new(0, 2, 0.5, -10.5)
        dot.BackgroundColor3 = Colors.Text
        dot.Parent = toggle
        
        local dotCorner = Instance.new("UICorner")
        dotCorner.CornerRadius = UDim.new(0, 10)
        dotCorner.Parent = dot
        
        -- State
        local state = default or false
        if state then
            dot.Position = UDim2.new(1, -23, 0.5, -10.5)
            toggle.BackgroundColor3 = Colors.Primary
        end
        
        -- Click area
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 1, 0)
        btn.BackgroundTransparency = 1
        btn.Text = ""
        btn.Parent = frame
        
        -- Hover effect
        frame.MouseEnter:Connect(function()
            Tween(frame, {BackgroundColor3 = Colors.Foreground:lerp(Colors.Primary, 0.1)}, 0.15)
        end)
        
        frame.MouseLeave:Connect(function()
            Tween(frame, {BackgroundColor3 = Colors.Foreground}, 0.15)
        end)
        
        -- Click
        btn.MouseButton1Click:Connect(function()
            state = not state
            if state then
                Tween(dot, {Position = UDim2.new(1, -23, 0.5, -10.5)}, 0.15)
                Tween(toggle, {BackgroundColor3 = Colors.Primary}, 0.15)
            else
                Tween(dot, {Position = UDim2.new(0, 2, 0.5, -10.5)}, 0.15)
                Tween(toggle, {BackgroundColor3 = Colors.Border}, 0.15)
            end
            
            if callback then callback(state) end
        end)
        
        return frame
    end
    
    -- DROPDOWN (GUARANTEED TO SHOW)
    function methods:Dropdown(text, options, callback)
        local frame = Instance.new("Frame")
        frame.Name = "Dropdown_" .. text
        frame.Size = UDim2.new(1, -20, 0, 40)
        frame.BackgroundColor3 = Colors.Foreground
        frame.ClipsDescendants = true
        frame.LayoutOrder = #self.CurrentTab.Content:GetChildren() + 1
        frame.Parent = self.CurrentTab.Content
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = frame
        
        -- Button
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 40)
        btn.BackgroundTransparency = 1
        btn.Text = ""
        btn.Parent = frame
        
        -- Label
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.8, 0, 1, 0)
        label.Position = UDim2.new(0, 15, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text .. " ▼"
        label.TextColor3 = Colors.Text
        label.TextSize = 14
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = btn
        
        -- Options frame
        local optionsFrame = Instance.new("Frame")
        optionsFrame.Size = UDim2.new(1, 0, 0, 0)
        optionsFrame.Position = UDim2.new(0, 0, 0, 40)
        optionsFrame.BackgroundColor3 = Colors.Background
        optionsFrame.Visible = false
        optionsFrame.Parent = frame
        
        local optionsCorner = Instance.new("UICorner")
        optionsCorner.CornerRadius = UDim.new(0, 6)
        optionsCorner.Parent = optionsFrame
        
        local open = false
        
        local function toggle()
            open = not open
            if open then
                frame.Size = UDim2.new(1, -20, 0, 40 + (#options * 35))
                optionsFrame.Visible = true
                Tween(optionsFrame, {Size = UDim2.new(1, 0, 0, #options * 35)}, 0.2)
                label.Text = text .. " ▲"
            else
                Tween(optionsFrame, {Size = UDim2.new(1, 0, 0, 0)}, 0.2)
                label.Text = text .. " ▼"
                task.wait(0.2)
                if not open then
                    optionsFrame.Visible = false
                    frame.Size = UDim2.new(1, -20, 0, 40)
                end
            end
        end
        
        -- Create options
        for i, option in ipairs(options) do
            local optBtn = Instance.new("TextButton")
            optBtn.Size = UDim2.new(1, 0, 0, 35)
            optBtn.BackgroundColor3 = Colors.Background
            optBtn.Text = option
            optBtn.TextColor3 = Colors.Text
            optBtn.TextSize = 13
            optBtn.Font = Enum.Font.Gotham
            optBtn.Parent = optionsFrame
            
            -- Option hover
            optBtn.MouseEnter:Connect(function()
                Tween(optBtn, {BackgroundColor3 = Colors.Foreground}, 0.15)
            end)
            
            optBtn.MouseLeave:Connect(function()
                Tween(optBtn, {BackgroundColor3 = Colors.Background}, 0.15)
            end)
            
            optBtn.MouseButton1Click:Connect(function()
                toggle()
                if callback then callback(option) end
            end)
        end
        
        btn.MouseButton1Click:Connect(toggle)
        
        -- Frame hover
        frame.MouseEnter:Connect(function()
            Tween(frame, {BackgroundColor3 = Colors.Foreground:lerp(Colors.Primary, 0.2)}, 0.15)
        end)
        
        frame.MouseLeave:Connect(function()
            if not open then
                Tween(frame, {BackgroundColor3 = Colors.Foreground}, 0.15)
            end
        end)
        
        return frame
    end
    
    return setmetatable(methods, {__index = methods})
end

-- Notification (250x100)
function UILibrary:Notification(title, message, duration)
    duration = duration or 5
    
    local notifGui = Instance.new("ScreenGui")
    notifGui.Name = "Notification_" .. math.random(1000, 9999)
    
    if game.CoreGui then
        notifGui.Parent = game.CoreGui
    else
        notifGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    end
    
    local frame = Instance.new("Frame")
    frame.Name = "Notification"
    frame.Size = UDim2.new(0, 250, 0, 100)
    frame.Position = UDim2.new(1, -260, 0.5, -50)
    frame.BackgroundColor3 = Colors.Background
    frame.BorderSizePixel = 0
    frame.Parent = notifGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = frame
    
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Colors.Primary
    stroke.Parent = frame
    
    -- FIX: Notification dragging without camera movement
    local notifDragging = false
    local notifDragStart, notifWindowStart
    
    local function startNotifDrag(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            notifDragging = true
            notifDragStart = input.Position
            notifWindowStart = frame.Position
            
            -- Prevent camera movement
            game:GetService("ContextActionService"):BindAction(
                "PreventNotificationCameraDrag",
                function() return Enum.ContextActionResult.Sink end,
                false,
                Enum.UserInputType.MouseMovement,
                Enum.UserInputType.MouseButton1
            )
        end
    end
    
    local function updateNotifDrag(input)
        if notifDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - notifDragStart
            frame.Position = UDim2.new(
                notifWindowStart.X.Scale,
                notifWindowStart.X.Offset + delta.X,
                notifWindowStart.Y.Scale,
                notifWindowStart.Y.Offset + delta.Y
            )
        end
    end
    
    local function endNotifDrag()
        if notifDragging then
            notifDragging = false
            game:GetService("ContextActionService"):UnbindAction("PreventNotificationCameraDrag")
        end
    end
    
    -- Title
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -20, 0, 25)
    titleLabel.Position = UDim2.new(0, 10, 0, 8)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Colors.Text
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.GothamSemibold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = frame
    
    -- Make title draggable
    titleLabel.InputBegan:Connect(startNotifDrag)
    titleLabel.InputChanged:Connect(updateNotifDrag)
    titleLabel.InputEnded:Connect(endNotifDrag)
    
    -- Message
    local msgLabel = Instance.new("TextLabel")
    msgLabel.Size = UDim2.new(1, -20, 1, -40)
    msgLabel.Position = UDim2.new(0, 10, 0, 40)
    msgLabel.BackgroundTransparency = 1
    msgLabel.Text = message
    msgLabel.TextColor3 = Colors.SubText
    msgLabel.TextSize = 12
    msgLabel.Font = Enum.Font.Gotham
    msgLabel.TextWrapped = true
    msgLabel.TextXAlignment = Enum.TextXAlignment.Left
    msgLabel.TextYAlignment = Enum.TextYAlignment.Top
    msgLabel.Parent = frame
    
    -- Close button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 22, 0, 22)
    closeBtn.Position = UDim2.new(1, -32, 0, 8)
    closeBtn.BackgroundColor3 = Colors.Close
    closeBtn.TextColor3 = Colors.Text
    closeBtn.TextSize = 16
    closeBtn.Text = "×"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = frame
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 5)
    btnCorner.Parent = closeBtn
    
    closeBtn.MouseButton1Click:Connect(function()
        notifGui:Destroy()
    end)
    
    closeBtn.MouseEnter:Connect(function()
        Tween(closeBtn, {BackgroundColor3 = Colors.Close:lerp(Color3.new(1,1,1), 0.3)}, 0.2)
    end)
    
    closeBtn.MouseLeave:Connect(function()
        Tween(closeBtn, {BackgroundColor3 = Colors.Close}, 0.2)
    end)
    
    -- Auto close
    task.spawn(function()
        task.wait(duration)
        if notifGui and notifGui.Parent then
            Tween(frame, {Size = UDim2.new(0, 0, 0, 0)}, 0.2)
            task.wait(0.2)
            notifGui:Destroy()
        end
    end)
    
    return notifGui
end

return UILibrary
